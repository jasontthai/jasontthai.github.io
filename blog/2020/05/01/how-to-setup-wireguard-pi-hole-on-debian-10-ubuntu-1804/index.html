<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 --><title>How to Setup Wireguard + Pi-hole on Debian 10 / Ubuntu 18.04 | Jason’s Notes</title><meta name="generator" content="Jekyll v3.8.7" /><meta property="og:title" content="How to Setup Wireguard + Pi-hole on Debian 10 / Ubuntu 18.04" /><meta name="author" content="Jason Thai" /><meta property="og:locale" content="en_US" /><meta name="description" content="How to Setup an Ad-free VPN with Wireguard + Pi-hole on Debian 10 / Ubuntu 18.04" /><meta property="og:description" content="How to Setup an Ad-free VPN with Wireguard + Pi-hole on Debian 10 / Ubuntu 18.04" /><link rel="canonical" href="https://jasonthai.me/blog/2020/05/01/how-to-setup-wireguard-pi-hole-on-debian-10-ubuntu-1804/" /><meta property="og:url" content="https://jasonthai.me/blog/2020/05/01/how-to-setup-wireguard-pi-hole-on-debian-10-ubuntu-1804/" /><meta property="og:site_name" content="Jason’s Notes" /><meta property="og:image" content="https://jasonthai.me/assets/img/openvpn-pihole.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-05-01T00:00:00+00:00" /> <script type="application/ld+json"> {"@type":"BlogPosting","url":"https://jasonthai.me/blog/2020/05/01/how-to-setup-wireguard-pi-hole-on-debian-10-ubuntu-1804/","image":"https://jasonthai.me/assets/img/openvpn-pihole.png","headline":"How to Setup Wireguard + Pi-hole on Debian 10 / Ubuntu 18.04","dateModified":"2020-05-01T00:00:00+00:00","datePublished":"2020-05-01T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jasonthai.me/blog/2020/05/01/how-to-setup-wireguard-pi-hole-on-debian-10-ubuntu-1804/"},"author":{"@type":"Person","name":"Jason Thai"},"description":"How to Setup an Ad-free VPN with Wireguard + Pi-hole on Debian 10 / Ubuntu 18.04","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --><link rel="stylesheet" href="/assets/css/style.css"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png"><meta name="theme-color" content="#fff" /><link type="application/atom+xml" rel="alternate" href="https://jasonthai.me/feed.xml" title="Jason's Notes" /><!-- <script src="/assets/js/lazysizes.min.js" async=""></script> --> <!-- <script src="/assets/js/ls.unveilhooks.min.js" async=""></script> --> <script type="text/javascript"> /*! lazysizes - v5.1.0 */ !function(a,b){var c=b(a,a.document);a.lazySizes=c,"object"==typeof module&&module.exports&&(module.exports=c)}("undefined"!=typeof window?window:{},function(a,b){"use strict";var c,d;if(function(){var b,c={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};d=a.lazySizesConfig||a.lazysizesConfig||{};for(b in c)b in d||(d[b]=c[b])}(),!b||!b.getElementsByClassName)return{init:function(){},cfg:d,noSupport:!0};var e=b.documentElement,f=a.Date,g=a.HTMLPictureElement,h="addEventListener",i="getAttribute",j=a[h],k=a.setTimeout,l=a.requestAnimationFrame||k,m=a.requestIdleCallback,n=/^picture$/i,o=["load","error","lazyincluded","_lazyloaded"],p={},q=Array.prototype.forEach,r=function(a,b){return p[b]||(p[b]=new RegExp("(\\s|^)"+b+"(\\s|$)")),p[b].test(a[i]("class")||"")&&p[b]},s=function(a,b){r(a,b)||a.setAttribute("class",(a[i]("class")||"").trim()+" "+b)},t=function(a,b){var c;(c=r(a,b))&&a.setAttribute("class",(a[i]("class")||"").replace(c," "))},u=function(a,b,c){var d=c?h:"removeEventListener";c&&u(a,b),o.forEach(function(c){a[d](c,b)})},v=function(a,d,e,f,g){var h=b.createEvent("Event");return e||(e={}),e.instance=c,h.initEvent(d,!f,!g),h.detail=e,a.dispatchEvent(h),h},w=function(b,c){var e;!g&&(e=a.picturefill||d.pf)?(c&&c.src&&!b[i]("srcset")&&b.setAttribute("srcset",c.src),e({reevaluate:!0,elements:[b]})):c&&c.src&&(b.src=c.src)},x=function(a,b){return(getComputedStyle(a,null)||{})[b]},y=function(a,b,c){for(c=c||a.offsetWidth;c<d.minSize&&b&&!a._lazysizesWidth;)c=b.offsetWidth,b=b.parentNode;return c},z=function(){var a,c,d=[],e=[],f=d,g=function(){var b=f;for(f=d.length?e:d,a=!0,c=!1;b.length;)b.shift()();a=!1},h=function(d,e){a&&!e?d.apply(this,arguments):(f.push(d),c||(c=!0,(b.hidden?k:l)(g)))};return h._lsFlush=g,h}(),A=function(a,b){return b?function(){z(a)}:function(){var b=this,c=arguments;z(function(){a.apply(b,c)})}},B=function(a){var b,c=0,e=d.throttleDelay,g=d.ricTimeout,h=function(){b=!1,c=f.now(),a()},i=m&&g>49?function(){m(h,{timeout:g}),g!==d.ricTimeout&&(g=d.ricTimeout)}:A(function(){k(h)},!0);return function(a){var d;(a=!0===a)&&(g=33),b||(b=!0,d=e-(f.now()-c),d<0&&(d=0),a||d<9?i():k(i,d))}},C=function(a){var b,c,d=99,e=function(){b=null,a()},g=function(){var a=f.now()-c;a<d?k(g,d-a):(m||e)(e)};return function(){c=f.now(),b||(b=k(g,d))}},D=function(){var g,l,m,o,p,y,D,F,G,H,I,J,K=/^img$/i,L=/^iframe$/i,M="onscroll"in a&&!/(gle|ing)bot/.test(navigator.userAgent),N=0,O=0,P=0,Q=-1,R=function(a){P--,(!a||P<0||!a.target)&&(P=0)},S=function(a){return null==J&&(J="hidden"==x(b.body,"visibility")),J||"hidden"!=x(a.parentNode,"visibility")&&"hidden"!=x(a,"visibility")},T=function(a,c){var d,f=a,g=S(a);for(F-=c,I+=c,G-=c,H+=c;g&&(f=f.offsetParent)&&f!=b.body&&f!=e;)(g=(x(f,"opacity")||1)>0)&&"visible"!=x(f,"overflow")&&(d=f.getBoundingClientRect(),g=H>d.left&&G<d.right&&I>d.top-1&&F<d.bottom+1);return g},U=function(){var a,f,h,j,k,m,n,p,q,r,s,t,u=c.elements;if((o=d.loadMode)&&P<8&&(a=u.length)){for(f=0,Q++;f<a;f++)if(u[f]&&!u[f]._lazyRace)if(!M||c.prematureUnveil&&c.prematureUnveil(u[f]))aa(u[f]);else if((p=u[f][i]("data-expand"))&&(m=1*p)||(m=O),r||(r=!d.expand||d.expand<1?e.clientHeight>500&&e.clientWidth>500?500:370:d.expand,c._defEx=r,s=r*d.expFactor,t=d.hFac,J=null,O<s&&P<1&&Q>2&&o>2&&!b.hidden?(O=s,Q=0):O=o>1&&Q>1&&P<6?r:N),q!==m&&(y=innerWidth+m*t,D=innerHeight+m,n=-1*m,q=m),h=u[f].getBoundingClientRect(),(I=h.bottom)>=n&&(F=h.top)<=D&&(H=h.right)>=n*t&&(G=h.left)<=y&&(I||H||G||F)&&(d.loadHidden||S(u[f]))&&(l&&P<3&&!p&&(o<3||Q<4)||T(u[f],m))){if(aa(u[f]),k=!0,P>9)break}else!k&&l&&!j&&P<4&&Q<4&&o>2&&(g[0]||d.preloadAfterLoad)&&(g[0]||!p&&(I||H||G||F||"auto"!=u[f][i](d.sizesAttr)))&&(j=g[0]||u[f]);j&&!k&&aa(j)}},V=B(U),W=function(a){var b=a.target;if(b._lazyCache)return void delete b._lazyCache;R(a),s(b,d.loadedClass),t(b,d.loadingClass),u(b,Y),v(b,"lazyloaded")},X=A(W),Y=function(a){X({target:a.target})},Z=function(a,b){try{a.contentWindow.location.replace(b)}catch(c){a.src=b}},$=function(a){var b,c=a[i](d.srcsetAttr);(b=d.customMedia[a[i]("data-media")||a[i]("media")])&&a.setAttribute("media",b),c&&a.setAttribute("srcset",c)},_=A(function(a,b,c,e,f){var g,h,j,l,o,p;(o=v(a,"lazybeforeunveil",b)).defaultPrevented||(e&&(c?s(a,d.autosizesClass):a.setAttribute("sizes",e)),h=a[i](d.srcsetAttr),g=a[i](d.srcAttr),f&&(j=a.parentNode,l=j&&n.test(j.nodeName||"")),p=b.firesLoad||"src"in a&&(h||g||l),o={target:a},s(a,d.loadingClass),p&&(clearTimeout(m),m=k(R,2500),u(a,Y,!0)),l&&q.call(j.getElementsByTagName("source"),$),h?a.setAttribute("srcset",h):g&&!l&&(L.test(a.nodeName)?Z(a,g):a.src=g),f&&(h||l)&&w(a,{src:g})),a._lazyRace&&delete a._lazyRace,t(a,d.lazyClass),z(function(){var b=a.complete&&a.naturalWidth>1;p&&!b||(b&&s(a,"ls-is-cached"),W(o),a._lazyCache=!0,k(function(){"_lazyCache"in a&&delete a._lazyCache},9)),"lazy"==a.loading&&P--},!0)}),aa=function(a){if(!a._lazyRace){var b,c=K.test(a.nodeName),e=c&&(a[i](d.sizesAttr)||a[i]("sizes")),f="auto"==e;(!f&&l||!c||!a[i]("src")&&!a.srcset||a.complete||r(a,d.errorClass)||!r(a,d.lazyClass))&&(b=v(a,"lazyunveilread").detail,f&&E.updateElem(a,!0,a.offsetWidth),a._lazyRace=!0,P++,_(a,b,f,e,c))}},ba=C(function(){d.loadMode=3,V()}),ca=function(){3==d.loadMode&&(d.loadMode=2),ba()},da=function(){if(!l){if(f.now()-p<999)return void k(da,999);l=!0,d.loadMode=3,V(),j("scroll",ca,!0)}};return{_:function(){p=f.now(),c.elements=b.getElementsByClassName(d.lazyClass),g=b.getElementsByClassName(d.lazyClass+" "+d.preloadClass),j("scroll",V,!0),j("resize",V,!0),a.MutationObserver?new MutationObserver(V).observe(e,{childList:!0,subtree:!0,attributes:!0}):(e[h]("DOMNodeInserted",V,!0),e[h]("DOMAttrModified",V,!0),setInterval(V,999)),j("hashchange",V,!0),["focus","mouseover","click","load","transitionend","animationend"].forEach(function(a){b[h](a,V,!0)}),/d$|^c/.test(b.readyState)?da():(j("load",da),b[h]("DOMContentLoaded",V),k(da,2e4)),c.elements.length?(U(),z._lsFlush()):V()},checkElems:V,unveil:aa,_aLSL:ca}}(),E=function(){var a,c=A(function(a,b,c,d){var e,f,g;if(a._lazysizesWidth=d,d+="px",a.setAttribute("sizes",d),n.test(b.nodeName||""))for(e=b.getElementsByTagName("source"),f=0,g=e.length;f<g;f++)e[f].setAttribute("sizes",d);c.detail.dataAttr||w(a,c.detail)}),e=function(a,b,d){var e,f=a.parentNode;f&&(d=y(a,f,d),e=v(a,"lazybeforesizes",{width:d,dataAttr:!!b}),e.defaultPrevented||(d=e.detail.width)&&d!==a._lazysizesWidth&&c(a,f,e,d))},f=function(){var b,c=a.length;if(c)for(b=0;b<c;b++)e(a[b])},g=C(f);return{_:function(){a=b.getElementsByClassName(d.autosizesClass),j("resize",g)},checkElems:g,updateElem:e}}(),F=function(){!F.i&&b.getElementsByClassName&&(F.i=!0,E._(),D._())};return k(function(){d.init&&F()}),c={cfg:d,autoSizer:E,loader:D,init:F,uP:w,aC:s,rC:t,hC:r,fire:v,gW:y,rAF:z}}); /*! lazysizes - v5.1.0 */ !function(a,b){var c=function(){b(a.lazySizes),a.removeEventListener("lazyunveilread",c,!0)};b=b.bind(null,a,a.document),"object"==typeof module&&module.exports?b(require("lazysizes")):a.lazySizes?c():a.addEventListener("lazyunveilread",c,!0)}(window,function(a,b,c){"use strict";function d(a,c){if(!g[a]){var d=b.createElement(c?"link":"script"),e=b.getElementsByTagName("script")[0];c?(d.rel="stylesheet",d.href=a):d.src=a,g[a]=!0,g[d.src||d.href]=!0,e.parentNode.insertBefore(d,e)}}var e,f,g={};b.addEventListener&&(f=/\(|\)|\s|'/,e=function(a,c){var d=b.createElement("img");d.onload=function(){d.onload=null,d.onerror=null,d=null,c()},d.onerror=d.onload,d.src=a,d&&d.complete&&d.onload&&d.onload()},addEventListener("lazybeforeunveil",function(a){if(a.detail.instance==c){var b,g,h,i;a.defaultPrevented||("none"==a.target.preload&&(a.target.preload="auto"),b=a.target.getAttribute("data-link"),b&&d(b,!0),b=a.target.getAttribute("data-script"),b&&d(b),b=a.target.getAttribute("data-require"),b&&(c.cfg.requireJs?c.cfg.requireJs([b]):d(b)),h=a.target.getAttribute("data-bg"),h&&(a.detail.firesLoad=!0,g=function(){a.target.style.backgroundImage="url("+(f.test(h)?JSON.stringify(h):h)+")",a.detail.firesLoad=!1,c.fire(a.target,"_lazyloaded",{},!0,!0)},e(h,g)),(i=a.target.getAttribute("data-poster"))&&(a.detail.firesLoad=!0,g=function(){a.target.poster=i,a.detail.firesLoad=!1,c.fire(a.target,"_lazyloaded",{},!0,!0)},e(i,g)))}},!1))}); </script> <script> /* Check that service workers are supported */ if ('serviceWorker' in navigator) { /* Use the window load event to keep the page load performant */ window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js'); }); } </script> <!-- Matomo --> <script type="text/javascript"> var _paq = window._paq || []; /* tracker methods like "setCustomDimension" should be called before "trackPageView" */ _paq.push(["setDocumentTitle", document.domain + "/" + document.title]); _paq.push(['trackPageView']); _paq.push(['enableLinkTracking']); _paq.push(['enableHeartBeatTimer']); (function() { var u="//analytics.jasonthai.me/"; _paq.push(['setTrackerUrl', u+'matomo.php']); _paq.push(['setSiteId', '1']); var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s); })(); </script> <noscript><p><img src="//analytics.jasonthai.me/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt="" /></p></noscript> <!-- End Matomo Code --></head><body class="flex flex-column vh-100"><header class="avenir"><nav class="db bb b--light-silver dt-l w-100 border-box pa3 ph5-l"> <a class="db dtc-l v-mid mid-gray link underline-hover w-100 w-25-l tc tl-l mb2 mb0-l f3-l" href="/" title="Home"> <img src="/favicon.png" class="v-mid w2 h2 br-100" alt="Site Name"> Jason's Notes </a><div class="db dtc-l v-mid w-100 w-75-l tc tr-l"><a class="link underline-hover dark-gray f6 f5-l dib mr3 mr4-l" href="/about/">About</a><a class="link underline-hover dark-gray f6 f5-l dib mr3 mr4-l" href="/services/">Services</a><a class="link underline-hover dark-gray f6 f5-l dib mr3 mr4-l" href="/posts/">Posts</a><a class="link underline-hover dark-gray f6 f5-l dib mr3 mr4-l" href="/categories/">Categories</a><a class="link underline-hover dark-gray f6 f5-l dib mr3 mr4-l" href="/visited-places/">Places I Visited</a></div></nav></header><main class="db h-auto w-100 ph5-l flex-grow-1" aria-label="Content"><div class="db fl-l w-100"><article class="avenir center w-two-thirds-ns w-90"><header class="pt2 pt3-ns"><h1 class="tc f1-l lh-title mt0 baskerville">How to Setup Wireguard + Pi-hole on Debian 10 / Ubuntu 18.04</h1><time class="tc f5 f4-l db">May 1, 2020 </time><p class="tc f5 mb4 center lh-copy"> Jason Thai</p></header><div class=""><div class="db f5 lh-copy"><ul class="section-nav"><li class="toc-entry toc-h2"><a href="#introduction">Introduction</a></li><li class="toc-entry toc-h2"><a href="#installation">Installation</a><ul><li class="toc-entry toc-h3"><a href="#wireguard-setup">Wireguard Setup</a></li><li class="toc-entry toc-h3"><a href="#start-wireguard">Start Wireguard</a></li><li class="toc-entry toc-h3"><a href="#pi-hole-setup">Pi-hole Setup</a></li><li class="toc-entry toc-h3"><a href="#test-dns-settings">Test DNS settings</a></li><li class="toc-entry toc-h3"><a href="#generate-wireguard-client-config-file">Generate Wireguard Client Config File</a></li><li class="toc-entry toc-h3"><a href="#configure-wireguard-to-use-pi-hole-dns">Configure Wireguard to use Pi-hole DNS</a></li><li class="toc-entry toc-h3"><a href="#test-from-browser">Test From Browser</a></li><li class="toc-entry toc-h3"><a href="#pi-hole-statistics">Pi-hole Statistics</a></li></ul></li><li class="toc-entry toc-h2"><a href="#conclusion">Conclusion</a></li><li class="toc-entry toc-h2"><a href="#references">References</a></li></ul><blockquote><p>WireGuard® is an extremely simple yet fast and modern VPN that utilizes state-of-the-art cryptography. It aims to be faster, simpler, leaner, and more useful than IPsec, while avoiding the massive headache. It intends to be considerably more performant than OpenVPN. WireGuard is designed as a general purpose VPN for running on embedded interfaces and super computers alike, fit for many different circumstances. Initially released for the Linux kernel, it is now cross-platform (Windows, macOS, BSD, iOS, Android) and widely deployable. It is currently under heavy development, but already it might be regarded as the most secure, easiest to use, and simplest VPN solution in the industry. <a href="https://www.wireguard.com/">https://www.wireguard.com</a></p></blockquote><h2 id="introduction"> <a class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2><p>Follow up for my post <a href="https://jasonthai.me/blog/2019/08/25/how-to-host-openvpn-and-pi-hole-on-ubuntu-1804-vps/">How to host OpenVPN and Pi-hole on Ubuntu 18.04 VPS</a>. This is a guide to set up wireguard + pi-hole for your own private ad blocking VPN.</p><h2 id="installation"> <a class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2><h3 id="wireguard-setup"> <a class="anchor" href="#wireguard-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wireguard Setup</h3><p>Run these scripts:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://git.io/wireguard <span class="nt">-O</span> wireguard-install.sh <span class="o">&amp;&amp;</span> bash wireguard-install.sh
</code></pre></div></div><p>Follow this setup:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Welcome to this WireGuard road warrior installer!

I need to ask you a few questions before starting setup.
You can use the default options and just press enter <span class="k">if </span>you are ok with them.

What IPv4 address should the WireGuard server use?
     1<span class="o">)</span> Your IPv4 address should show up here
     2<span class="o">)</span> other <span class="nb">local </span>IP
IPv4 address <span class="o">[</span>1]: 1

What port <span class="k">do </span>you want WireGuard listening to?
Port <span class="o">[</span>51820]: 51820

Tell me a name <span class="k">for </span>the first client.
Client name <span class="o">[</span>client]: client

Which DNS <span class="k">do </span>you want to use <span class="k">for </span>this client?
   1<span class="o">)</span> Current system resolvers
   2<span class="o">)</span> 1.1.1.1
   3<span class="o">)</span> Google
   4<span class="o">)</span> OpenDNS
   5<span class="o">)</span> NTT
   6<span class="o">)</span> AdGuard
DNS <span class="o">[</span>1]: 2

We are ready to <span class="nb">set </span>up your WireGuard server now.

Press any key to <span class="k">continue</span>...
</code></pre></div></div><h3 id="start-wireguard"> <a class="anchor" href="#start-wireguard" aria-hidden="true"><span class="octicon octicon-link"></span></a>Start Wireguard</h3><p>Wireguard should start automatically after you ran the script. If not you can check by</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl status wg-quick@wg0.service
</code></pre></div></div><p>Restart Wireguard services:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl restart wg-quick@wg0.service
</code></pre></div></div><h3 id="pi-hole-setup"> <a class="anchor" href="#pi-hole-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pi-hole Setup</h3><p>Note down Wireguard’s IP:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip a show dev wg0
10.7.0.1/24 // note this address
</code></pre></div></div><p>Note down your default gateway IP address:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip r | <span class="nb">grep </span>default
default via XXX.XXX.XXX.XXX dev eth0 onlink // note this address
</code></pre></div></div><p>Run this script:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-sSL</span> https://install.pi-hole.net | bash
</code></pre></div></div><p>Follow the instruction to set up pi-hole:</p><ul><li>Installing dependencies</li></ul><picture> <source srcset="https://jasonthai.me/assets/img/pihole-wireguard-1.webp" type="image/webp"></source> <img class="db ml-auto mr-auto" src="https://jasonthai.me/assets/img/pihole-wireguard-1.png" alt="step 1"> </picture><ul><li>The following step is important, make sure to select <code class="highlighter-rouge">wg0</code> as the interface</li></ul><picture> <source srcset="https://jasonthai.me/assets/img/pihole-wireguard-2.webp" type="image/webp"></source> <img class="db ml-auto mr-auto" src="https://jasonthai.me/assets/img/pihole-wireguard-2.png" alt="step 2"> </picture><ul><li>Choose the DNS provider Pi-hole will use.</li></ul><picture> <source srcset="https://jasonthai.me/assets/img/pihole-wireguard-3.webp" type="image/webp"></source> <img class="db ml-auto mr-auto" src="https://jasonthai.me/assets/img/pihole-wireguard-3.png" alt="step 3"> </picture><ul><li>Choose the protocols available to you</li></ul><picture> <source srcset="https://jasonthai.me/assets/img/pihole-wireguard-4.webp" type="image/webp"></source> <img class="db ml-auto mr-auto" src="https://jasonthai.me/assets/img/pihole-wireguard-4.png" alt="step 4"> </picture><ul><li>This following step is important, make sure to choose <code class="highlighter-rouge">no</code> so we can assign our internal address which is <code class="highlighter-rouge">10.7.0.1</code>.</li></ul><picture> <source srcset="https://jasonthai.me/assets/img/pihole-wireguard-5.webp" type="image/webp"></source> <img class="db ml-auto mr-auto" src="https://jasonthai.me/assets/img/pihole-wireguard-5.png" alt="step 5"> </picture><ul><li>Enter <code class="highlighter-rouge">10.7.0.1/24</code>. This is the static address VPN will use to talk to Pi-hole</li></ul><picture> <source srcset="https://jasonthai.me/assets/img/pihole-wireguard-6.webp" type="image/webp"></source> <img class="db ml-auto mr-auto" src="https://jasonthai.me/assets/img/pihole-wireguard-6.png" alt="step 6"> </picture><ul><li>Enter the ipv4-gateway you noted down</li></ul><picture> <source srcset="https://jasonthai.me/assets/img/pihole-wireguard-7.webp" type="image/webp"></source> <img class="db ml-auto mr-auto" src="https://jasonthai.me/assets/img/pihole-wireguard-7.png" alt="step 7"> </picture><ul><li>There are a few more steps but I just choose the default settings.</li></ul><h3 id="test-dns-settings"> <a class="anchor" href="#test-dns-settings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test DNS settings</h3><p>Run this script</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>host google.com 10.7.0.1

<span class="c"># Output from host google.com 10.7.0.1</span>
google.com has address 172.217.0.46
google.com has IPv6 address 2607:f8b0:4005:80b::200e
google.com mail is handled by 10 aspmx.l.google.com.
google.com mail is handled by 20 alt1.aspmx.l.google.com.
google.com mail is handled by 30 alt2.aspmx.l.google.com.
google.com mail is handled by 40 alt3.aspmx.l.google.com.
google.com mail is handled by 50 alt4.aspmx.l.google.com.
</code></pre></div></div><p>Our Wireguard + Pi-hole still see google.com’s public IPs properly</p><p>This time run</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>host pagead2.googlesyndication.com

<span class="c"># Output from host pagead2.googlesyndication.com</span>
pagead2.googlesyndication.com has address 0.0.0.0
pagead2.googlesyndication.com has IPv6 address ::
pagead2.googlesyndication.com is an <span class="nb">alias </span><span class="k">for </span>pagead46.l.doubleclick.net.
</code></pre></div></div><p>Pi-hole blocked <code class="highlighter-rouge">pagead2.googlesyndication.com</code> as the domain is in its blacklist.</p><h3 id="generate-wireguard-client-config-file"> <a class="anchor" href="#generate-wireguard-client-config-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generate Wireguard Client Config File</h3><p>Run <code class="highlighter-rouge">bash wireguard-install.sh</code></p><h3 id="configure-wireguard-to-use-pi-hole-dns"> <a class="anchor" href="#configure-wireguard-to-use-pi-hole-dns" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure Wireguard to use Pi-hole DNS</h3><p>Edit your wireguard client conf file and update the DNS servers setting with Pi-hole internal address. In my case it is <code class="highlighter-rouge">10.7.0.1</code></p><h3 id="test-from-browser"> <a class="anchor" href="#test-from-browser" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test From Browser</h3><p>After connecting to your VPN using Wireguard client. Go to this address <a href="http://pagead2.googlesyndication.com">http://pagead2.googlesyndication.com</a>, if everything works correctly you will see this:</p><picture> <source srcset="https://jasonthai.me/assets/img/google-syndication.webp" type="image/webp"></source> <img class="db ml-auto mr-auto" src="https://jasonthai.me/assets/img/google-syndication.png" alt="google syndication"> </picture><h3 id="pi-hole-statistics"> <a class="anchor" href="#pi-hole-statistics" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pi-hole Statistics</h3><p>You can go to <code class="highlighter-rouge">http://pi.hole/admin</code> once you are connected to the VPN and see some of Pi-hole’s stats. The result is mind-boggling. Almost half of my traffic is to serve ads.</p><picture> <source srcset="https://jasonthai.me/assets/img/pi-hole-stats.webp" type="image/webp"></source> <img class="db ml-auto mr-auto" src="https://jasonthai.me/assets/img/pi-hole-stats.png" alt="Pi-hole stats"> </picture><h2 id="conclusion"> <a class="anchor" href="#conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion</h2><p>Pi-hole is a good solution to fight against ads on the internet. You should give it a try. That said not all ads are bad. Some creators are reliant on ads as their source of income. If you have someone you support, consider whitelisting the ads for the good cause.</p><h2 id="references"> <a class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h2><ul><li><a href="https://github.com/Nyr/wireguard-install">https://github.com/Nyr/wireguard-install</a></li><li><a href="https://pi-hole.net/">https://pi-hole.net/</a></li></ul></div><div class="flex items-center justify-center pa4"> <a href="/blog/2020/03/14/donate-compute-power-to-foldinghome-to-cures-for-covid-19/" class="f5 no-underline black bg-animate hover-bg-black hover-white inline-flex items-center pa3 ba border-box mr4"> <svg class="w1" data-icon="chevronLeft" viewBox="0 0 32 32" style="fill:currentcolor"><title>chevronLeft icon</title><path d="M20 1 L24 5 L14 16 L24 27 L20 31 L6 16 z"></path> </svg> <span class="pl1">Previous</span> </a> <a href="/blog/2020/06/08/high-availability-series-part-i-set-up-and-secure-mariadb-on-debian-servers/" class="f5 no-underline black bg-animate hover-bg-black hover-white inline-flex items-center pa3 ba border-box"> <span class="pr1">Next</span> <svg class="w1" data-icon="chevronRight" viewBox="0 0 32 32" style="fill:currentcolor"><title>chevronRight icon</title><path d="M12 1 L26 16 L12 31 L8 27 L18 16 L8 5 z"></path> </svg> </a></div><div id="commento"></div><script src="https://commento.jasonthai.me/js/commento.js"></script></div></article></div></main><footer class="avenir mid-gray flex-shrink-0"><div class="db w-100 h-auto fl mt3 pv4 bt b--light-silver"> <small class="f6 db tc"><b class="ttu">Jason&#39;s Notes</b> © 2019 - 2020</small></div></footer></body></html>
