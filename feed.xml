<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.6">Jekyll</generator><link href="https://jasonthai.me/feed.xml" rel="self" type="application/atom+xml" /><link href="https://jasonthai.me/" rel="alternate" type="text/html" /><updated>2020-03-02T22:03:45+00:00</updated><id>https://jasonthai.me/feed.xml</id><title type="html">Jason’s Notes</title><subtitle>Jason Thai's personal page</subtitle><author><name>Jason Thai</name></author><entry><title type="html">Some Notes on Apache Spark Memory Management</title><link href="https://jasonthai.me/blog/2020/02/27/some-notes-on-apache-spark-memory-management/" rel="alternate" type="text/html" title="Some Notes on Apache Spark Memory Management" /><published>2020-02-27T00:00:00+00:00</published><updated>2020-02-27T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2020/02/27/some-notes-on-apache-spark-memory-management</id><content type="html" xml:base="https://jasonthai.me/blog/2020/02/27/some-notes-on-apache-spark-memory-management/">&lt;h2 id=&quot;important-configurations&quot;&gt;Important configurations:&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.executor.memory&lt;/span&gt; – Size of memory to use for each executor that runs the task.&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.executor.cores&lt;/span&gt; – Number of virtual cores.&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.driver.memory&lt;/span&gt; – Size of memory to use for the driver.&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.driver.cores&lt;/span&gt; – Number of virtual cores to use for the driver.&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.executor.instances&lt;/span&gt; – Number of executors. Set this parameter unless spark.dynamicAllocation.enabled is set to true.&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.default.parallelism&lt;/span&gt; – Default number of partitions in resilient distributed datasets (RDDs) returned by transformations like join, reduceByKey, and parallelize when no partition number is set by the user&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.sql.execution.arrow.enabled&lt;/span&gt; - Enable optimization for panda dataframe&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.files.ignoreCorruptFiles&lt;/span&gt; - Ignore corrupt files&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.sql.files.ignoreCorruptFiles&lt;/span&gt; - Ignore corrupt files&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.executor.extraJavaOptions&lt;/span&gt; - Other Java options like garbage collection for executors&lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.driver.extraJavaOptions&lt;/span&gt; - Other Java options like garbage collection for drivers&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;sample-calculations&quot;&gt;Sample Calculations:&lt;/h2&gt;

&lt;p&gt;Consider an EMR cluster with 1 master - 25 slaves running c5.18xlarge instance. Each instance comes with 72vCPU, 144 GiB Memory.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.executor.cores&lt;/span&gt; = number of virtual cores per executor. Recommendation is 5
    &lt;blockquote&gt;
      &lt;p&gt;spark.excutor.cores = 5&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;Number of executors per instance = (total number of virtual cores per instance - 1)/ spark.executors.cores&lt;br /&gt;
    &lt;blockquote&gt;
      &lt;p&gt;Number of executors per instance = (72 - 1) / 5 = 14&lt;/p&gt;
    &lt;/blockquote&gt;

    &lt;p&gt;Total executor memory = total RAM per instance / number of executors per instance&lt;br /&gt;&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;Total executor memory = 144 / 14 = 10 (round down)&lt;/p&gt;
    &lt;/blockquote&gt;

    &lt;p&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.executors.memory&lt;/span&gt; = total executor memory * 0.9&lt;/p&gt;
    &lt;blockquote&gt;
      &lt;p&gt;spark.executors.memory = 10 * 0.9 = 9g&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.executor.memoryOverhead&lt;/span&gt; = total executor memory * 0.10
    &lt;blockquote&gt;
      &lt;p&gt;spark.excutor.memoryOverhead = 10 * 0.1 = 1g&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.driver.memory&lt;/span&gt; = spark.executors.memory
    &lt;blockquote&gt;
      &lt;p&gt;spark.driver.memory = 9g&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.driver.cores&lt;/span&gt;= spark.executors.cores
    &lt;blockquote&gt;
      &lt;p&gt;spark.driver.cores = 5&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.executor.instances&lt;/span&gt; = (number of executors per instance * number of core instances) minus 1 for the driver
    &lt;blockquote&gt;
      &lt;p&gt;spark.executor.instances = 14 * 25 - 1 = 349&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.default.parallelism&lt;/span&gt; = spark.executor.instances * spark.executors.cores * 2
    &lt;blockquote&gt;
      &lt;p&gt;spark.default.parallelism = 349 * 5 * 2 = 3490&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.executor.extraJavaOptions&lt;/span&gt;
    &lt;blockquote&gt;
      &lt;p&gt;spark.executor.extraJavaOptions = -XX:+UseG1GC -XX:+UnlockDiagnosticVMOptions -XX:+G1SummarizeConcMark -XX:InitiatingHeapOccupancyPercent=35 -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:OnOutOfMemoryError=’kill -9 %p’&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;span style=&quot;color: darkred&quot;&gt;spark.driver.extraJavaOptions&lt;/span&gt;
    &lt;blockquote&gt;
      &lt;p&gt;spark.executor.extraJavaOptions = -XX:+UseG1GC -XX:+UnlockDiagnosticVMOptions -XX:+G1SummarizeConcMark -XX:InitiatingHeapOccupancyPercent=35 -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:OnOutOfMemoryError=’kill -9 %p’&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;sources&quot;&gt;Sources:&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://aws.amazon.com/blogs/big-data/best-practices-for-successfully-managing-memory-for-apache-spark-applications-on-amazon-emr/&quot;&gt;https://aws.amazon.com/blogs/big-data/best-practices-for-successfully-managing-memory-for-apache-spark-applications-on-amazon-emr/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html&quot;&gt;https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Jason Thai</name></author><category term="tech" /><category term="en" /><summary type="html">Important configurations: spark.executor.memory – Size of memory to use for each executor that runs the task. spark.executor.cores – Number of virtual cores. spark.driver.memory – Size of memory to use for the driver. spark.driver.cores – Number of virtual cores to use for the driver. spark.executor.instances – Number of executors. Set this parameter unless spark.dynamicAllocation.enabled is set to true. spark.default.parallelism – Default number of partitions in resilient distributed datasets (RDDs) returned by transformations like join, reduceByKey, and parallelize when no partition number is set by the user spark.sql.execution.arrow.enabled - Enable optimization for panda dataframe spark.files.ignoreCorruptFiles - Ignore corrupt files spark.sql.files.ignoreCorruptFiles - Ignore corrupt files spark.executor.extraJavaOptions - Other Java options like garbage collection for executors spark.driver.extraJavaOptions - Other Java options like garbage collection for drivers Sample Calculations: Consider an EMR cluster with 1 master - 25 slaves running c5.18xlarge instance. Each instance comes with 72vCPU, 144 GiB Memory. spark.executor.cores = number of virtual cores per executor. Recommendation is 5 spark.excutor.cores = 5 Number of executors per instance = (total number of virtual cores per instance - 1)/ spark.executors.cores Number of executors per instance = (72 - 1) / 5 = 14 Total executor memory = total RAM per instance / number of executors per instance Total executor memory = 144 / 14 = 10 (round down) spark.executors.memory = total executor memory * 0.9 spark.executors.memory = 10 * 0.9 = 9g spark.executor.memoryOverhead = total executor memory * 0.10 spark.excutor.memoryOverhead = 10 * 0.1 = 1g spark.driver.memory = spark.executors.memory spark.driver.memory = 9g spark.driver.cores= spark.executors.cores spark.driver.cores = 5 spark.executor.instances = (number of executors per instance * number of core instances) minus 1 for the driver spark.executor.instances = 14 * 25 - 1 = 349 spark.default.parallelism = spark.executor.instances * spark.executors.cores * 2 spark.default.parallelism = 349 * 5 * 2 = 3490 spark.executor.extraJavaOptions spark.executor.extraJavaOptions = -XX:+UseG1GC -XX:+UnlockDiagnosticVMOptions -XX:+G1SummarizeConcMark -XX:InitiatingHeapOccupancyPercent=35 -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:OnOutOfMemoryError=’kill -9 %p’ spark.driver.extraJavaOptions spark.executor.extraJavaOptions = -XX:+UseG1GC -XX:+UnlockDiagnosticVMOptions -XX:+G1SummarizeConcMark -XX:InitiatingHeapOccupancyPercent=35 -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:OnOutOfMemoryError=’kill -9 %p’ Sources: https://aws.amazon.com/blogs/big-data/best-practices-for-successfully-managing-memory-for-apache-spark-applications-on-amazon-emr/ https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/spark.png" /><media:content medium="image" url="https://jasonthai.me/assets/img/spark.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Better SSH Keys Management with AuthorizedKeysCommand</title><link href="https://jasonthai.me/blog/2020/02/19/better-ssh-keys-management-with-authorizedkeyscommand/" rel="alternate" type="text/html" title="Better SSH Keys Management with AuthorizedKeysCommand" /><published>2020-02-19T00:00:00+00:00</published><updated>2020-02-19T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2020/02/19/better-ssh-keys-management-with-authorizedkeyscommand</id><content type="html" xml:base="https://jasonthai.me/blog/2020/02/19/better-ssh-keys-management-with-authorizedkeyscommand/">&lt;p&gt;I usually use authorized_key files to store SSH public keys in order to access my servers . However once I start to have multiple servers, I realize manually managing SSH keys is nightmare.&lt;/p&gt;

&lt;p&gt;Recently I found out a better way to manage these SSH keys
In /etc/ssh/sshd_config file there are 2 configurations:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;AuthorizedKeysCommand /keys.sh
AuthorizedKeysCommandUser nobody
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can use &lt;strong&gt;AuthorizedKeysCommand&lt;/strong&gt; to point to an script that returns all the SSH keys. In this case, my script is:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
curl https://raw.githubusercontent.com/jasontthai/keys/master/&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Name this file &lt;code class=&quot;highlighter-rouge&quot;&gt;key.sh&lt;/code&gt; and make it executable: &lt;code class=&quot;highlighter-rouge&quot;&gt;chmod a+x /keys.sh&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The public keys are stored in a Github repo which can be updated any time. The structure of the repo is this:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;keys/
├── user1
├── user2
├── user3
└── user4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I login with  user1, the server will get user1’s public keys from Github and validates it agaisnt user1’s private key.&lt;/p&gt;

&lt;p&gt;There are a few problems with this approach:  I rely on an external service to retrieve the public keys. If Github goes offline, I will be unable to login to my servers at all. This also adds latency to the login step as we need to retrieve the keys over the internet. So I should think about some caching mechanism in case this happens.&lt;/p&gt;</content><author><name>Jason Thai</name></author><category term="tech" /><category term="en" /><summary type="html">I usually use authorized_key files to store SSH public keys in order to access my servers . However once I start to have multiple servers, I realize manually managing SSH keys is nightmare. Recently I found out a better way to manage these SSH keys In /etc/ssh/sshd_config file there are 2 configurations: AuthorizedKeysCommand /keys.sh AuthorizedKeysCommandUser nobody We can use AuthorizedKeysCommand to point to an script that returns all the SSH keys. In this case, my script is: #!/bin/bash curl https://raw.githubusercontent.com/jasontthai/keys/master/$1 Name this file key.sh and make it executable: chmod a+x /keys.sh The public keys are stored in a Github repo which can be updated any time. The structure of the repo is this: keys/ ├── user1 ├── user2 ├── user3 └── user4 When I login with user1, the server will get user1’s public keys from Github and validates it agaisnt user1’s private key. There are a few problems with this approach: I rely on an external service to retrieve the public keys. If Github goes offline, I will be unable to login to my servers at all. This also adds latency to the login step as we need to retrieve the keys over the internet. So I should think about some caching mechanism in case this happens.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/ssh.jpg" /><media:content medium="image" url="https://jasonthai.me/assets/img/ssh.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Setup Shell Script for Linux-based Servers</title><link href="https://jasonthai.me/blog/2020/02/12/setup-shell-script-for-linux-based-servers/" rel="alternate" type="text/html" title="Setup Shell Script for Linux-based Servers" /><published>2020-02-12T00:00:00+00:00</published><updated>2020-02-12T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2020/02/12/setup-shell-script-for-linux-based-servers</id><content type="html" xml:base="https://jasonthai.me/blog/2020/02/12/setup-shell-script-for-linux-based-servers/">&lt;p&gt;Since I have a few Linux servers that are running RHEL, Debian or Ubuntu OS, I want to have an automatic and convenient way to quickly set up and get them running.  Specifically I want to do a the following things for a fresh server:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Upgrade the server’s packages to the latest version&lt;/li&gt;
  &lt;li&gt;Install essential packages such as: fail2ban, ufw, htop, apache2, docker, etc.&lt;/li&gt;
  &lt;li&gt;Create new user with sudo access&lt;/li&gt;
  &lt;li&gt;Disable root login and password authentication in favor of SSH keys&lt;/li&gt;
  &lt;li&gt;Ability to install other packages if required&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With that in mind, I created a simple setup script which you can find here: &lt;a href=&quot;https://github.com/jasontthai/shell-scripts&quot;&gt;https://github.com/jasontthai/shell-scripts&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;running-the-script&quot;&gt;Running the Script&lt;/h3&gt;
&lt;p&gt;To run the script manually with prompt so you can decide what the script does:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -L json.id/setup.sh | sudo bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To run the script in automatic mode without prompt except for adding new user:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -L json.id/setup.sh | sudo bash -s -- -a
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;example-of-output&quot;&gt;Example of output&lt;/h3&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-sL&lt;/span&gt; json.id/setup.sh | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;bash
&lt;span class=&quot;c&quot;&gt;# ## ## ## ## ## ## ## ## ## ## ## ## #&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           VPS Setup Script          #&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ## ## ## ## ## ## ## ## ## ## ## ## #&lt;/span&gt;

Wed 12 Feb 2020 03:56:01 PM PST
Updating system...

Installing Basic Packages: &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;ufw fail2ban htop curl apache2

Add Sudo User? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y/N]: y
Disable Root Login? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y/N]: y
Disable Password Authentication? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y/N]: y
Install Docker? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y/N]: y
Install Docker Compose? &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y/N]: y
Enter your TIMEZONE &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Empty to skip]:
Enter any other packages to be installed &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Empty to skip]:

Setting &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;user...
Username: testuser
Password:

Adding SSH Keys
Enter SSH Key &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;Empty to skip]:

Disabling Root Login...

Disabling Password Authentication...

Docker Installed. Added testuser to docker group

Docker Compose Installed.

Finished setup script.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or to view help&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-sL&lt;/span&gt; json.id/setup.sh | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;bash &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ## ## ## ## ## ## ## ## ## ## ## ## #&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#           VPS Setup Script          #&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# ## ## ## ## ## ## ## ## ## ## ## ## #&lt;/span&gt;

Wed 12 Feb 2020 04:04:07 PM PST

Usage: ./setup.sh &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-mh&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
       curl &lt;span class=&quot;nt&quot;&gt;-sL&lt;/span&gt; json.id/setup.sh | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;bash
       curl &lt;span class=&quot;nt&quot;&gt;-sL&lt;/span&gt; json.id/setup.sh | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;bash &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;ah&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

Flags:
       &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; : run setup script automatically
       &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt; : prints this lovely message, &lt;span class=&quot;k&quot;&gt;then &lt;/span&gt;exits
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Jason Thai</name></author><category term="tech" /><category term="en" /><summary type="html">Since I have a few Linux servers that are running RHEL, Debian or Ubuntu OS, I want to have an automatic and convenient way to quickly set up and get them running. Specifically I want to do a the following things for a fresh server: Upgrade the server’s packages to the latest version Install essential packages such as: fail2ban, ufw, htop, apache2, docker, etc. Create new user with sudo access Disable root login and password authentication in favor of SSH keys Ability to install other packages if required With that in mind, I created a simple setup script which you can find here: https://github.com/jasontthai/shell-scripts Running the Script To run the script manually with prompt so you can decide what the script does: curl -L json.id/setup.sh | sudo bash To run the script in automatic mode without prompt except for adding new user: curl -L json.id/setup.sh | sudo bash -s -- -a Example of output curl -sL json.id/setup.sh | sudo bash # ## ## ## ## ## ## ## ## ## ## ## ## # # VPS Setup Script # # ## ## ## ## ## ## ## ## ## ## ## ## # Wed 12 Feb 2020 03:56:01 PM PST Updating system... Installing Basic Packages: sudo ufw fail2ban htop curl apache2 Add Sudo User? [y/N]: y Disable Root Login? [y/N]: y Disable Password Authentication? [y/N]: y Install Docker? [y/N]: y Install Docker Compose? [y/N]: y Enter your TIMEZONE [Empty to skip]: Enter any other packages to be installed [Empty to skip]: Setting sudo user... Username: testuser Password: Adding SSH Keys Enter SSH Key [Empty to skip]: Disabling Root Login... Disabling Password Authentication... Docker Installed. Added testuser to docker group Docker Compose Installed. Finished setup script. or to view help curl -sL json.id/setup.sh | sudo bash -s -- -h # ## ## ## ## ## ## ## ## ## ## ## ## # # VPS Setup Script # # ## ## ## ## ## ## ## ## ## ## ## ## # Wed 12 Feb 2020 04:04:07 PM PST Usage: ./setup.sh [-mh] curl -sL json.id/setup.sh | sudo bash curl -sL json.id/setup.sh | sudo bash -s --{ah} Flags: -a : run setup script automatically -h : prints this lovely message, then exits</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/scripts.png" /><media:content medium="image" url="https://jasonthai.me/assets/img/scripts.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Free Public xBrowserSync Service</title><link href="https://jasonthai.me/blog/2020/01/03/free-public-xbrowsersync-service/" rel="alternate" type="text/html" title="Free Public xBrowserSync Service" /><published>2020-01-03T00:00:00+00:00</published><updated>2020-01-03T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2020/01/03/free-public-xbrowsersync-service</id><content type="html" xml:base="https://jasonthai.me/blog/2020/01/03/free-public-xbrowsersync-service/">&lt;p&gt;TL;DR: My xbrowsersync service API can be accessed through: &lt;a href=&quot;https://xbrowsersync.jasonthai.me&quot;&gt;https://xbrowsersync.jasonthai.me&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Before using xBrowserSync, I do not have a good way of consolidating all my bookmarks. xBrowserSync helps me sync all my bookmarks across different browsers like Chrome, Firefox, Brave, etc.&lt;/p&gt;

&lt;p&gt;After you have downloaded the &lt;a href=&quot;https://www.xbrowsersync.org/#download&quot;&gt;extension for your browser&lt;/a&gt;, you can either use the default provided xbrowsersync service or you can update to my service in the setting:&lt;/p&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/xbrowsersync-setting.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/xbrowsersync-setting.jpeg&quot; alt=&quot;xbrowsersync setting&quot; /&gt;
&lt;/picture&gt;

&lt;p&gt;From &lt;a href=&quot;https://xbrowsersync.org&quot;&gt;https://xbrowsersync.org&lt;/a&gt;:&lt;/p&gt;

&lt;blockquote&gt;

  &lt;p&gt;xBrowserSync is a free and open-source alternative to browser syncing tools offered by companies like Google, Firefox, Opera and others. The project was born out of a concern for the over-reliance on services provided by big tech, who collect as much personal data as they can and have demonstrated that they do not respect their user’s privacy . Now, with the proliferation of open-source code and projects it’s easier than ever to create tools and services that allow users to take back control of their data!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;

  &lt;p&gt;xBrowserSync respects your privacy and gives you complete anonymity. No sign up is required and no personal data is ever collected. To start syncing simply download xBrowserSync for your desktop browser or mobile platform, enter an encryption password and click Create New Sync! You’ll receive an anonymous sync ID which identifies your data and can be used to access your data on other browsers and devices.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;

  &lt;p&gt;xBrowserSync does not only sync but also enhances your productivity by enriching your native browser bookmarks with the addition of descriptions and tags, and an intuitive search interface enables you to find, modify and share bookmarks quickly and easily. xBrowserSync even adds descriptions and tags to new bookmarks for you automatically. And don’t ever worry about losing your data thanks to the included back up and restore functionality.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;

  &lt;p&gt;The xBrowserSync desktop browser web extension syncs your browser data between desktop browsers. It works with the browser’s native bookmarking features so you can keep using the native tools whilst always staying in sync. If you like to organise your bookmarks into folders don’t worry, xBrowserSync respects your bookmark hierarchy and syncs it across your browsers.&lt;/p&gt;
&lt;/blockquote&gt;</content><author><name>Jason Thai</name></author><category term="tech" /><category term="en" /><summary type="html">TL;DR: My xbrowsersync service API can be accessed through: https://xbrowsersync.jasonthai.me Before using xBrowserSync, I do not have a good way of consolidating all my bookmarks. xBrowserSync helps me sync all my bookmarks across different browsers like Chrome, Firefox, Brave, etc. After you have downloaded the extension for your browser, you can either use the default provided xbrowsersync service or you can update to my service in the setting: From https://xbrowsersync.org: xBrowserSync is a free and open-source alternative to browser syncing tools offered by companies like Google, Firefox, Opera and others. The project was born out of a concern for the over-reliance on services provided by big tech, who collect as much personal data as they can and have demonstrated that they do not respect their user’s privacy . Now, with the proliferation of open-source code and projects it’s easier than ever to create tools and services that allow users to take back control of their data! xBrowserSync respects your privacy and gives you complete anonymity. No sign up is required and no personal data is ever collected. To start syncing simply download xBrowserSync for your desktop browser or mobile platform, enter an encryption password and click Create New Sync! You’ll receive an anonymous sync ID which identifies your data and can be used to access your data on other browsers and devices. xBrowserSync does not only sync but also enhances your productivity by enriching your native browser bookmarks with the addition of descriptions and tags, and an intuitive search interface enables you to find, modify and share bookmarks quickly and easily. xBrowserSync even adds descriptions and tags to new bookmarks for you automatically. And don’t ever worry about losing your data thanks to the included back up and restore functionality. The xBrowserSync desktop browser web extension syncs your browser data between desktop browsers. It works with the browser’s native bookmarking features so you can keep using the native tools whilst always staying in sync. If you like to organise your bookmarks into folders don’t worry, xBrowserSync respects your bookmark hierarchy and syncs it across your browsers.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/xbrowsersync.png" /><media:content medium="image" url="https://jasonthai.me/assets/img/xbrowsersync.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">December List of Selfhosted Apps</title><link href="https://jasonthai.me/blog/2019/12/26/december-list-of-selfhosted-apps/" rel="alternate" type="text/html" title="December List of Selfhosted Apps" /><published>2019-12-26T00:00:00+00:00</published><updated>2019-12-26T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2019/12/26/december-list-of-selfhosted-apps</id><content type="html" xml:base="https://jasonthai.me/blog/2019/12/26/december-list-of-selfhosted-apps/">&lt;p&gt;This is probably the last post of December 2019. I wish everyone has had a good year so far and an exciting 2020.&lt;/p&gt;

&lt;p&gt;I have been playing around with selfhosting some more and here is the list of apps I am currently hosting:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.portainer.io&quot;&gt;Portainer&lt;/a&gt; - Docker management system&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://heimdall.site&quot;&gt;Heimdall&lt;/a&gt; - Application dashboard&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://plex.tv&quot;&gt;Plex&lt;/a&gt; - Media management system&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://tautulli.com&quot;&gt;Tautulli&lt;/a&gt; - Plex media server monitoring&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://ombi.io&quot;&gt;Ombi&lt;/a&gt; - Request movies &amp;amp; TV for plex users&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://nextcloud.com&quot;&gt;Nextcloud&lt;/a&gt; - Productivity platform and more&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://bitwarden.com&quot;&gt;Bitwarden&lt;/a&gt; - Password manager&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Current server providers I am using:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://terrahost.no&quot;&gt;TerraHost&lt;/a&gt; - Dedicated server for media streaming&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://hetzner.com&quot;&gt;Hetzner&lt;/a&gt; - Dedicated server for media streaming&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://smarthost.com&quot;&gt;Smarthost&lt;/a&gt; - VPS for selfhosted apps&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://hosthatch.com&quot;&gt;Hosthatch&lt;/a&gt; - Storage VPS&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://ionswitch.com&quot;&gt;IonSwitch&lt;/a&gt; - VPS for my blog&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://buyvm.net&quot;&gt;Buyvm&lt;/a&gt; - VPS for VPN&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://php-friends.de&quot;&gt;PHP-Friends&lt;/a&gt; - VPS for selfhosted apps&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://letbox.com&quot;&gt;Letbox&lt;/a&gt; - Storage VPS&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://inceptionhosting.com&quot;&gt;InceptionHosting&lt;/a&gt; - VPS for VPN&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://hostsolutions.ro&quot;&gt;Hostsolutions&lt;/a&gt; - Storage VPS&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Tools I am using to monitor servers:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://hetrixtools.com&quot;&gt;HetrixTools&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/BotoX/ServerStatus&quot;&gt;ServerStatus&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Server forums I am checking:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://lowendtalk.com&quot;&gt;LowendTalk&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://talk.lowendspirit.com&quot;&gt;LowendSpirit&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Feel free to contact me if you are interested in knowing more about these selfhosted apps. Cheers!&lt;/p&gt;</content><author><name>Jason Thai</name></author><category term="tech" /><category term="en" /><summary type="html">This is probably the last post of December 2019. I wish everyone has had a good year so far and an exciting 2020. I have been playing around with selfhosting some more and here is the list of apps I am currently hosting: Portainer - Docker management system Heimdall - Application dashboard Plex - Media management system Tautulli - Plex media server monitoring Ombi - Request movies &amp;amp; TV for plex users Nextcloud - Productivity platform and more Bitwarden - Password manager Current server providers I am using: TerraHost - Dedicated server for media streaming Hetzner - Dedicated server for media streaming Smarthost - VPS for selfhosted apps Hosthatch - Storage VPS IonSwitch - VPS for my blog Buyvm - VPS for VPN PHP-Friends - VPS for selfhosted apps Letbox - Storage VPS InceptionHosting - VPS for VPN Hostsolutions - Storage VPS Tools I am using to monitor servers: HetrixTools ServerStatus Server forums I am checking: LowendTalk LowendSpirit Feel free to contact me if you are interested in knowing more about these selfhosted apps. Cheers!</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/cloud-server.png" /><media:content medium="image" url="https://jasonthai.me/assets/img/cloud-server.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Deploy Nextcloud With Docker Compose in Ubuntu 18.04</title><link href="https://jasonthai.me/blog/2019/11/03/deploy-nextcloud-with-docker-compose/" rel="alternate" type="text/html" title="Deploy Nextcloud With Docker Compose in Ubuntu 18.04" /><published>2019-11-03T00:00:00+00:00</published><updated>2019-11-03T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2019/11/03/deploy-nextcloud-with-docker-compose</id><content type="html" xml:base="https://jasonthai.me/blog/2019/11/03/deploy-nextcloud-with-docker-compose/">&lt;p&gt;In one of the previous posts, I mentioned using &lt;a href=&quot;https://nextcloud.com/&quot;&gt;Nextcloud&lt;/a&gt; as a self-hosted cloud platform. This post goes into details how I set up my instance.&lt;/p&gt;

&lt;h2 id=&quot;install-docker-and-docker-compose&quot;&gt;Install Docker and Docker-Compose&lt;/h2&gt;
&lt;p&gt;To install docker, run:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To install docker-compose, run:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;docker-composeyml&quot;&gt;docker-compose.yml&lt;/h2&gt;
&lt;p&gt;Create this &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt; with following contents:&lt;/p&gt;
&lt;div class=&quot;language-yaml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;na&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;3'&lt;/span&gt;

&lt;span class=&quot;na&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;mariadb&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;--transaction-isolation=READ-COMMITTED --binlog-format=ROW&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;always&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/opt/nextcloud-db:/var/lib/mysql&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;MYSQL_ROOT_PASSWORD=ENTER MYSQL PASSWORD&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;MYSQL_PASSWORD=ENTER MYSQL PASSWORD&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;MYSQL_DATABASE=nextcloud&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;MYSQL_USER=nextcloud&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;redis&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis:alpine&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;always&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nextcloud:apache&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;8080:80&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;REDIS_HOST=redis&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;db&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/opt/nextcloud-data:/var/www/html&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;always&lt;/span&gt;
  &lt;span class=&quot;na&quot;&gt;cron&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;nextcloud:apache&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;always&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/opt/nextcloud-data:/var/www/html&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;entrypoint&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;/cron.sh&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;pi&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;db&lt;/span&gt;
      &lt;span class=&quot;pi&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;redis&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Run &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-compose -f docker-compose.yml up -d&lt;/code&gt; to start all necessary containers.&lt;/p&gt;

&lt;h2 id=&quot;setting-up&quot;&gt;Setting Up&lt;/h2&gt;

&lt;p&gt;Browse to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://localhost:8080&lt;/code&gt; and you’ll see a set up page like this:&lt;/p&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/nextcloud-setup.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/nextcloud-setup.png&quot; alt=&quot;Setup&quot; /&gt;
&lt;/picture&gt;

&lt;p&gt;Fill in the fills as the following:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Database user: nextcloud&lt;/li&gt;
  &lt;li&gt;Database password: Enter your password in &lt;code class=&quot;highlighter-rouge&quot;&gt;docker-compose.yml&lt;/code&gt; file&lt;/li&gt;
  &lt;li&gt;Database name: nextcloud&lt;/li&gt;
  &lt;li&gt;Database host: db&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;After setting up nextcloud, you will see something like:&lt;/p&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/nextcloud.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/nextcloud.jpeg&quot; alt=&quot;Nextcloud&quot; /&gt;
&lt;/picture&gt;

&lt;h2 id=&quot;modify-upload-max-filesize&quot;&gt;Modify Upload Max Filesize&lt;/h2&gt;
&lt;p&gt;By default, Nextcloud only allows uploading file up to 2MB which is not very useful. We can modify the max filesize by adding &lt;code class=&quot;highlighter-rouge&quot;&gt;/opt/nextcloud-data/.htaccess&lt;/code&gt; with following:&lt;/p&gt;
&lt;div class=&quot;language-conf highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;&lt;span class=&quot;n&quot;&gt;IfModule&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mod_php7&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&amp;gt;
...
&lt;span class=&quot;n&quot;&gt;php_value&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;upload_max_filesize&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;G&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;php_value&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;post_max_size&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;G&lt;/span&gt;
&amp;lt;/&lt;span class=&quot;n&quot;&gt;IfModule&lt;/span&gt;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Jason Thai</name></author><category term="tech" /><category term="en" /><summary type="html">In one of the previous posts, I mentioned using Nextcloud as a self-hosted cloud platform. This post goes into details how I set up my instance. Install Docker and Docker-Compose To install docker, run: curl -fsSL https://get.docker.com -o get-docker.sh sh get-docker.sh To install docker-compose, run: sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose sudo chmod +x /usr/local/bin/docker-compose docker-compose.yml Create this docker-compose.yml with following contents: version: '3' services: db: image: mariadb command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW restart: always volumes: - /opt/nextcloud-db:/var/lib/mysql environment: - MYSQL_ROOT_PASSWORD=ENTER MYSQL PASSWORD - MYSQL_PASSWORD=ENTER MYSQL PASSWORD - MYSQL_DATABASE=nextcloud - MYSQL_USER=nextcloud redis: image: redis:alpine restart: always app: image: nextcloud:apache ports: - 8080:80 environment: - REDIS_HOST=redis depends_on: - db - redis volumes: - /opt/nextcloud-data:/var/www/html restart: always cron: image: nextcloud:apache restart: always volumes: - /opt/nextcloud-data:/var/www/html entrypoint: /cron.sh depends_on: - db - redis Run docker-compose -f docker-compose.yml up -d to start all necessary containers. Setting Up Browse to http://localhost:8080 and you’ll see a set up page like this: Fill in the fills as the following: Database user: nextcloud Database password: Enter your password in docker-compose.yml file Database name: nextcloud Database host: db After setting up nextcloud, you will see something like: Modify Upload Max Filesize By default, Nextcloud only allows uploading file up to 2MB which is not very useful. We can modify the max filesize by adding /opt/nextcloud-data/.htaccess with following: &amp;lt;IfModule mod_php7.c&amp;gt; ... php_value upload_max_filesize 16G php_value post_max_size 16G &amp;lt;/IfModule&amp;gt;</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/NextcloudLogo.png" /><media:content medium="image" url="https://jasonthai.me/assets/img/NextcloudLogo.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">What I’m up to in September 2019</title><link href="https://jasonthai.me/blog/2019/10/07/what-im-up-to-in-september-2019/" rel="alternate" type="text/html" title="What I'm up to in September 2019" /><published>2019-10-07T00:00:00+00:00</published><updated>2019-10-07T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2019/10/07/what-im-up-to-in-september-2019</id><content type="html" xml:base="https://jasonthai.me/blog/2019/10/07/what-im-up-to-in-september-2019/">&lt;p&gt;Vy finally came back after doing internship in Hanoi. It has a brief yet long 3 months for us. We also moved in the new apartment and although it took a while, we reached to a point where everything was set up. We bought a new dining table, 2 chairs, a new bed and some other kitchen items. We did a lot of things together for the first time too like baking. Vy and I managed to successfully bake a coffee cake. We also decided to eat at home more and I started cooking a bit.&lt;/p&gt;

&lt;p&gt;We spent quite a bit of money during this month as the cost of moving and buying things for the new place. As a result, I skipped one cycle of investing. Hopefully this will resume this coming month of October.&lt;/p&gt;

&lt;p&gt;I did not run so much in September and my legs are getting itchy. Hopefully I’ll run again soon in the new area.&lt;/p&gt;

&lt;p&gt;This upcoming month of October is the &lt;a href=&quot;https://www.dhs.gov/national-cyber-security-awareness-month&quot;&gt;Cybersecurity Awareness Month&lt;/a&gt;, please spend sometime going over your online presence, updating your passwords. That’s all folks.&lt;/p&gt;</content><author><name>Jason Thai</name></author><category term="blog" /><category term="en" /><summary type="html">Vy finally came back after doing internship in Hanoi. It has a brief yet long 3 months for us. We also moved in the new apartment and although it took a while, we reached to a point where everything was set up. We bought a new dining table, 2 chairs, a new bed and some other kitchen items. We did a lot of things together for the first time too like baking. Vy and I managed to successfully bake a coffee cake. We also decided to eat at home more and I started cooking a bit. We spent quite a bit of money during this month as the cost of moving and buying things for the new place. As a result, I skipped one cycle of investing. Hopefully this will resume this coming month of October. I did not run so much in September and my legs are getting itchy. Hopefully I’ll run again soon in the new area. This upcoming month of October is the Cybersecurity Awareness Month, please spend sometime going over your online presence, updating your passwords. That’s all folks.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/the-month-september.jpg" /><media:content medium="image" url="https://jasonthai.me/assets/img/the-month-september.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">What I’m up to in August 2019</title><link href="https://jasonthai.me/blog/2019/09/01/what-im-up-to-in-august-2019/" rel="alternate" type="text/html" title="What I'm up to in August 2019" /><published>2019-09-01T00:00:00+00:00</published><updated>2019-09-01T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2019/09/01/what-im-up-to-in-august-2019</id><content type="html" xml:base="https://jasonthai.me/blog/2019/09/01/what-im-up-to-in-august-2019/">&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/month-of-august.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/month-of-august.jpg&quot; alt=&quot;August&quot; /&gt;
&lt;/picture&gt;

&lt;p&gt;This month has been busy. I have been learning more about self-hosting software and doing some tinkering with them.&lt;/p&gt;

&lt;p&gt;Currently I am checking out these 2 subreddits:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://reddit.com/r/selfhosted&quot;&gt;https://reddit.com/r/selfhosted&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://reddit.com/r/homelab&quot;&gt;https://reddit.com/r/homelab&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These subs give me some motivation of creating my home server to store data and share with families and friends. But that will be the next step as I am using a cloud provider to do my hosting.&lt;/p&gt;

&lt;p&gt;What I am hosting:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://bitwarden.com&quot;&gt;Bitwarden&lt;/a&gt; - Opensource password manager. I decided to delete my Lastpass’s account and use a self-hosted Bitwarden instance to manage my passwords. So far so good. I keep my data.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://nextcloud.com&quot;&gt;Nextcloud&lt;/a&gt; - Productivity platform (Gsuite replacement). I use this to sync my files across computers. The platform offers a lot more than just file syncing. I haven’t explored much but it looks promising. Another file syncing alternative is &lt;a href=&quot;https://seafile.com&quot;&gt;Seafile&lt;/a&gt; which people say is more reliable.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://plex.tv&quot;&gt;Plex&lt;/a&gt; - Media organizer. I am also exploring hosting my media so I can view them everywhere. Another popular alternative is &lt;a href=&quot;https://github.com/jellyfin/jellyfin&quot;&gt;Jellyfin&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://tt-rss.org&quot;&gt;TT-RSS&lt;/a&gt; - RSS feeds&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://firefly-iii.org/&quot;&gt;Firefly-III&lt;/a&gt; - Budget app. I am also trying out this budget app. It is quite different from my &lt;a href=&quot;https://www.youneedabudget.com/&quot;&gt;YNAB&lt;/a&gt; and needs taking used too. So far I am more pleased with the latter one.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you want to try out these services, let me know and I can give you access to them.&lt;/p&gt;

&lt;p&gt;Moving on…
I am still reading about finance this month. They are easy to understand and are a nice complement to the ones I read in July. I highly recommend these books.&lt;/p&gt;

&lt;style type=&quot;text/css&quot; media=&quot;screen&quot;&gt;
  .gr_custom_container_1567354622 {
    /* customize your Goodreads widget container here*/
    border: 1px solid gray;
    border-radius:10px;
    padding: 10px 5px 10px 5px;
    background-color: #FFFFFF;
    color: #000000;
    width: 300px
  }
  .gr_custom_header_1567354622 {
    /* customize your Goodreads header here*/
    border-bottom: 1px solid gray;
    width: 100%;
    margin-bottom: 5px;
    text-align: center;
    font-size: 120%
  }
  .gr_custom_each_container_1567354622 {
    /* customize each individual book container here */
    width: 100%;
    clear: both;
    margin-bottom: 10px;
    overflow: auto;
    padding-bottom: 4px;
    border-bottom: 1px solid #aaa;
  }
  .gr_custom_book_container_1567354622 {
    /* customize your book covers here */
    overflow: hidden;
    height: 60px;
      float: left;
      margin-right: 4px;
      width: 39px;
  }
  .gr_custom_author_1567354622 {
    /* customize your author names here */
    font-size: 10px;
  }
  .gr_custom_tags_1567354622 {
    /* customize your tags here */
    font-size: 10px;
    color: gray;
  }
  .gr_custom_rating_1567354622 {
    /* customize your rating stars here */
    float: right;
  }
&lt;/style&gt;

&lt;div align=&quot;center&quot; id=&quot;gr_custom_widget_1567354622&quot;&gt;
          &lt;div class=&quot;gr_custom_container_1567354622&quot;&gt;
    &lt;h2 class=&quot;gr_custom_header_1567354622&quot;&gt;
    &lt;a style=&quot;text-decoration: none;&quot; rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/review/list/54938708-jason-thai?shelf=august-2019&amp;amp;utm_medium=api&amp;amp;utm_source=custom_widget&quot;&gt;Jason&amp;#39;s bookshelf: august-2019&lt;/a&gt;
    &lt;/h2&gt;
      &lt;div class=&quot;gr_custom_each_container_1567354622&quot;&gt;
          &lt;div class=&quot;gr_custom_book_container_1567354622&quot;&gt;
            &lt;a title=&quot;The Bogleheads' Guide to Investing&quot; rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/review/show/2960404866?utm_medium=api&amp;amp;utm_source=custom_widget&quot;&gt;&lt;img alt=&quot;The Bogleheads' Guide to Investing&quot; border=&quot;0&quot; src=&quot;https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1388380454l/381355._SY75_.jpg&quot; /&gt;&lt;/a&gt;
          &lt;/div&gt;
          &lt;div class=&quot;gr_custom_rating_1567354622&quot;&gt;
            &lt;span class=&quot; staticStars notranslate&quot;&gt;&lt;img src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;img alt=&quot;&quot; src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;img alt=&quot;&quot; src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;img alt=&quot;&quot; src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;img alt=&quot;&quot; src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class=&quot;gr_custom_title_1567354622&quot;&gt;
            &lt;a rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/review/show/2960404866?utm_medium=api&amp;amp;utm_source=custom_widget&quot;&gt;The Bogleheads' Guide to Investing&lt;/a&gt;
          &lt;/div&gt;
          &lt;div class=&quot;gr_custom_author_1567354622&quot;&gt;
            by &lt;a rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/author/show/66008.Taylor_Larimore&quot;&gt;Taylor Larimore&lt;/a&gt;
          &lt;/div&gt;
          &lt;div class=&quot;gr_custom_tags_1567354622&quot;&gt;
            tagged:
            august-2019
          &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class=&quot;gr_custom_each_container_1567354622&quot;&gt;
          &lt;div class=&quot;gr_custom_book_container_1567354622&quot;&gt;
            &lt;a title=&quot;The Bogleheads' Guide to the Three-Fund Portfolio: How a Simple Portfolio of Three Total Market Index Funds Outperforms Most Investors with Less Risk&quot; rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/review/show/2960405014?utm_medium=api&amp;amp;utm_source=custom_widget&quot;&gt;&lt;img alt=&quot;The Bogleheads' Guide to the Three-Fund Portfolio: How a Simple Portfolio of Three Total Market Index Funds Outperforms Most Investors with Less Risk&quot; border=&quot;0&quot; src=&quot;https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1528428190l/36809342._SY75_.jpg&quot; /&gt;&lt;/a&gt;
          &lt;/div&gt;
          &lt;div class=&quot;gr_custom_rating_1567354622&quot;&gt;
            &lt;span class=&quot; staticStars notranslate&quot;&gt;&lt;img src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;img alt=&quot;&quot; src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;img alt=&quot;&quot; src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;img alt=&quot;&quot; src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;img alt=&quot;&quot; src=&quot;https://www.goodreads.com/images/layout/gr_red_star_inactive.png&quot; /&gt;&lt;/span&gt;
          &lt;/div&gt;
          &lt;div class=&quot;gr_custom_title_1567354622&quot;&gt;
            &lt;a rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/review/show/2960405014?utm_medium=api&amp;amp;utm_source=custom_widget&quot;&gt;The Bogleheads' Guide to the Three-Fund Portfolio: How a Simple Portfolio of Three Total Market Index Funds Outperforms Most Investors with Less Risk&lt;/a&gt;
          &lt;/div&gt;
          &lt;div class=&quot;gr_custom_author_1567354622&quot;&gt;
            by &lt;a rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/author/show/66008.Taylor_Larimore&quot;&gt;Taylor Larimore&lt;/a&gt;
          &lt;/div&gt;
          &lt;div class=&quot;gr_custom_tags_1567354622&quot;&gt;
            tagged:
            august-2019
          &lt;/div&gt;
      &lt;/div&gt;
  &lt;br style=&quot;clear: both&quot; /&gt;
  &lt;center&gt;
    &lt;a rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/&quot;&gt;&lt;img alt=&quot;goodreads.com&quot; style=&quot;border:0&quot; src=&quot;https://www.goodreads.com/images/widget/widget_logo.gif&quot; /&gt;&lt;/a&gt;
  &lt;/center&gt;
  &lt;noscript&gt;
    Share &lt;a rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/&quot;&gt;book reviews&lt;/a&gt; and ratings with Jason, and even join a &lt;a rel=&quot;nofollow&quot; href=&quot;https://www.goodreads.com/group&quot;&gt;book club&lt;/a&gt; on Goodreads.
  &lt;/noscript&gt;
  &lt;/div&gt;

      &lt;/div&gt;
&lt;script src=&quot;https://www.goodreads.com/review/custom_widget/54938708.Jason's%20bookshelf:%20august-2019?cover_position=left&amp;amp;cover_size=small&amp;amp;num_books=5&amp;amp;order=a&amp;amp;shelf=august-2019&amp;amp;show_author=1&amp;amp;show_cover=1&amp;amp;show_rating=1&amp;amp;show_review=1&amp;amp;show_tags=1&amp;amp;show_title=1&amp;amp;sort=date_added&amp;amp;widget_bg_color=FFFFFF&amp;amp;widget_bg_transparent=&amp;amp;widget_border_width=1&amp;amp;widget_id=1567354622&amp;amp;widget_text_color=000000&amp;amp;widget_title_size=medium&amp;amp;widget_width=medium&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;

&lt;p&gt;Finally the biggest news, I am moving this upcoming September! I have been living at my current place for over four years. It suits well for a bachelor who is living alone. Now Vy is here with me, I want us to live someplace bigger and more comfortable. So it is exciting to move yet it is a little bit bittersweet as the current landlords are very nice people. Anyway, looking forward to the new place!&lt;/p&gt;</content><author><name>Jason Thai</name></author><category term="blog" /><category term="en" /><summary type="html">This month has been busy. I have been learning more about self-hosting software and doing some tinkering with them. Currently I am checking out these 2 subreddits: https://reddit.com/r/selfhosted https://reddit.com/r/homelab These subs give me some motivation of creating my home server to store data and share with families and friends. But that will be the next step as I am using a cloud provider to do my hosting. What I am hosting: Bitwarden - Opensource password manager. I decided to delete my Lastpass’s account and use a self-hosted Bitwarden instance to manage my passwords. So far so good. I keep my data. Nextcloud - Productivity platform (Gsuite replacement). I use this to sync my files across computers. The platform offers a lot more than just file syncing. I haven’t explored much but it looks promising. Another file syncing alternative is Seafile which people say is more reliable. Plex - Media organizer. I am also exploring hosting my media so I can view them everywhere. Another popular alternative is Jellyfin TT-RSS - RSS feeds Firefly-III - Budget app. I am also trying out this budget app. It is quite different from my YNAB and needs taking used too. So far I am more pleased with the latter one. If you want to try out these services, let me know and I can give you access to them. Moving on… I am still reading about finance this month. They are easy to understand and are a nice complement to the ones I read in July. I highly recommend these books. Jason&amp;#39;s bookshelf: august-2019 The Bogleheads' Guide to Investing by Taylor Larimore tagged: august-2019 The Bogleheads' Guide to the Three-Fund Portfolio: How a Simple Portfolio of Three Total Market Index Funds Outperforms Most Investors with Less Risk by Taylor Larimore tagged: august-2019 Share book reviews and ratings with Jason, and even join a book club on Goodreads. Finally the biggest news, I am moving this upcoming September! I have been living at my current place for over four years. It suits well for a bachelor who is living alone. Now Vy is here with me, I want us to live someplace bigger and more comfortable. So it is exciting to move yet it is a little bit bittersweet as the current landlords are very nice people. Anyway, looking forward to the new place!</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/month-of-august.jpg" /><media:content medium="image" url="https://jasonthai.me/assets/img/month-of-august.jpg" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">How to host OpenVPN and Pi-hole on Ubuntu 18.04 VPS</title><link href="https://jasonthai.me/blog/2019/08/25/how-to-host-openvpn-and-pi-hole-on-ubuntu-1804-vps/" rel="alternate" type="text/html" title="How to host OpenVPN and Pi-hole on Ubuntu 18.04 VPS" /><published>2019-08-25T00:00:00+00:00</published><updated>2019-08-25T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2019/08/25/how-to-host-openvpn-and-pi-hole-on-ubuntu-1804-vps</id><content type="html" xml:base="https://jasonthai.me/blog/2019/08/25/how-to-host-openvpn-and-pi-hole-on-ubuntu-1804-vps/">&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;I have been playing around with setting up my own &lt;a href=&quot;https://openvpn.net&quot;&gt;OpenVPN server&lt;/a&gt; lately and also found out &lt;a href=&quot;https://pi-hole.net&quot;&gt;Pi-hole&lt;/a&gt;.  OpenVPN provides a way to set up a VPN that I can self manage and Pi-hole is a network wide ad blocking system. The two combined services provide a good way to make your web browsing experience more secure and ad-free.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.pi-hole.net/guides/vpn/setup-openvpn-server/&quot;&gt;I followed the guide on Pi-hole to set up a VPN server&lt;/a&gt; but I found out that some information is missing depending on the type of VPS you have such as whether your VPS is a NAT VPS or not. Below is the documented steps of all my findings.&lt;/p&gt;

&lt;h2 id=&quot;installation&quot;&gt;Installation&lt;/h2&gt;

&lt;h3 id=&quot;openvpn-setup&quot;&gt;OpenVPN Setup&lt;/h3&gt;
&lt;p&gt;Run these scripts:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget https://git.io/vpn &lt;span class=&quot;nt&quot;&gt;-O&lt;/span&gt; openvpn-install.sh
&lt;span class=&quot;nb&quot;&gt;chmod &lt;/span&gt;755 openvpn-install.sh
./openvpn-install.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Follow this setup:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Welcome to this quick OpenVPN &lt;span class=&quot;s2&quot;&gt;&quot;road warrior&quot;&lt;/span&gt; installer

I need to ask you a few questions before starting the setup
You can leave the default options and just press enter &lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;you are ok with them

First I need to know the IPv4 address of the network interface you want OpenVPN
listening to.
IP address: 10.8.0.1 // Jason&lt;span class=&quot;s1&quot;&gt;'s notes: if you are behind NAT, just put your  ipv4 IP address

Which protocol do you want for OpenVPN connections?
   1) UDP (recommended)
   2) TCP
Protocol [1-2]: 1

What port do you want OpenVPN listening to?
Port: 1194

Which DNS do you want to use with the VPN?
   1) Current system resolvers
   2) Google
   3) OpenDNS
   4) NTT
   5) Hurricane Electric
   6) Verisign
DNS [1-6]: 1

Finally, tell me your name for the client certificate
Please, use one word only, no special characters
Client name: pihole

Okay, that was all I needed. We are ready to set up your OpenVPN server now
Press any key to continue...
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;start-openvpn&quot;&gt;Start OpenVPN&lt;/h3&gt;
&lt;p&gt;Modify OpenVPN server’s configuration in &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/openvpn/server/server.conf&lt;/code&gt;:
remove all the existing &lt;code class=&quot;highlighter-rouge&quot;&gt;push &quot;dhcp-option DNS x.x.x.x&lt;/code&gt; and add &lt;code class=&quot;highlighter-rouge&quot;&gt;push &quot;dhcp-option DNS 10.8.0.1&quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Restart OpenVPN services:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;systemctl daemon-reload
systemctl restart openvpn // Jason&lt;span class=&quot;s1&quot;&gt;'s notes: just restarting openvpn does not change the configuration for OpenVPN server.
systemctl restart openvpn-server@server.service
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notes: if you are behind a NAT, you will also need to do the following:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ip r | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;default

&lt;span class=&quot;c&quot;&gt;# Output from ip r | grep default&lt;/span&gt;
default via x.x.x.x dev eth0 onlink
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note the value after &lt;code class=&quot;highlighter-rouge&quot;&gt;dev&lt;/code&gt; in this case it is &lt;code class=&quot;highlighter-rouge&quot;&gt;eth0&lt;/code&gt;
Run  this:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; POSTROUTING  &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 10.8.0.0/24 &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; &amp;lt;value you got from above&amp;gt; &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; MASQUERADE

&lt;span class=&quot;c&quot;&gt;# Example:&lt;/span&gt;
iptables &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; nat &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; POSTROUTING &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; 10.8.0.0/24 &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; eth0 &lt;span class=&quot;nt&quot;&gt;-j&lt;/span&gt; MASQUERADE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;pi-hole-setup&quot;&gt;Pi-hole Setup&lt;/h3&gt;
&lt;p&gt;Run this script:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl &lt;span class=&quot;nt&quot;&gt;-sSL&lt;/span&gt; https://install.pi-hole.net | bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Follow the instruction to set up pi-hole:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Installing dependencies&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-1.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-1.png&quot; alt=&quot;step 1&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;Some instruction&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-2.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-2.png&quot; alt=&quot;step 2&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;Some information&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-3.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-3.png&quot; alt=&quot;step 3&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;This informs we need a &lt;strong&gt;static IP address&lt;/strong&gt; in order the the whole thing to work&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-4.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-4.png&quot; alt=&quot;step 4&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;The following step is important, make sure to select &lt;code class=&quot;highlighter-rouge&quot;&gt;tun0&lt;/code&gt; as the interface&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-5.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-5.png&quot; alt=&quot;step 5&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;Choose the DNS provider Pi-hole will use. This is interesting. Essentially we will set up pi-hole as a DNS OpenVPN server will use, and within Pi-hole it will use the DNS setting below to make outbound requests.&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-6.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-6.png&quot; alt=&quot;step 6&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;Choose the protocols available to you&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-7.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-7.png&quot; alt=&quot;step 7&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;This following step is important, make sure to choose &lt;code class=&quot;highlighter-rouge&quot;&gt;no&lt;/code&gt; so we can assign our internal address which is &lt;code class=&quot;highlighter-rouge&quot;&gt;10.8.0.1&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-8.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-8.png&quot; alt=&quot;step 8&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;Enter &lt;code class=&quot;highlighter-rouge&quot;&gt;10.8.0.1/24&lt;/code&gt;. This is the static address VPN will use to talk to Pi-hole&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-9.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-9.png&quot; alt=&quot;step 9&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;Enter the ipv4-gateway. I just leave this as is.&lt;/li&gt;
&lt;/ul&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pihole-step-10.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pihole-step-10.png&quot; alt=&quot;step 10&quot; /&gt;
&lt;/picture&gt;

&lt;ul&gt;
  &lt;li&gt;There are a few more steps but I just choose the default settings.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;test-dns-settings&quot;&gt;Test DNS settings&lt;/h3&gt;
&lt;p&gt;Run this script&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;host google.com 10.8.0.1

&lt;span class=&quot;c&quot;&gt;# Output from host google.com 10.8.0.1&lt;/span&gt;
google.com has address 172.217.0.46
google.com has IPv6 address 2607:f8b0:4005:80b::200e
google.com mail is handled by 10 aspmx.l.google.com.
google.com mail is handled by 20 alt1.aspmx.l.google.com.
google.com mail is handled by 30 alt2.aspmx.l.google.com.
google.com mail is handled by 40 alt3.aspmx.l.google.com.
google.com mail is handled by 50 alt4.aspmx.l.google.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Our OpenVPN + Pi-hole still see google.com’s public IPs properly&lt;/p&gt;

&lt;p&gt;This time run&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;host pagead2.googlesyndication.com

&lt;span class=&quot;c&quot;&gt;# Output from host pagead2.googlesyndication.com&lt;/span&gt;
pagead2.googlesyndication.com has address 0.0.0.0
pagead2.googlesyndication.com has IPv6 address ::
pagead2.googlesyndication.com is an &lt;span class=&quot;nb&quot;&gt;alias &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;pagead46.l.doubleclick.net.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Pi-hole blocked &lt;code class=&quot;highlighter-rouge&quot;&gt;pagead2.googlesyndication.com&lt;/code&gt; as the domain is in its blacklist.&lt;/p&gt;

&lt;h3 id=&quot;firewall-setup&quot;&gt;Firewall Setup&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.pi-hole.net/guides/vpn/firewall/&quot;&gt;I followed Pi-hole’s setup&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;generate-openvpn-client-config-file&quot;&gt;Generate OpenVPN Client Config File&lt;/h3&gt;
&lt;p&gt;Run &lt;code class=&quot;highlighter-rouge&quot;&gt;./openvpn-install.sh&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;test-from-browser&quot;&gt;Test From Browser&lt;/h3&gt;
&lt;p&gt;After connecting to your VPN using OpenVPN client. Go to this address &lt;a href=&quot;http://pagead2.googlesyndication.com&quot;&gt;http://pagead2.googlesyndication.com&lt;/a&gt;, if everything works correctly you will see this:&lt;/p&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/google-syndication.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/google-syndication.png&quot; alt=&quot;google syndication&quot; /&gt;
&lt;/picture&gt;

&lt;h3 id=&quot;pi-hole-statistics&quot;&gt;Pi-hole Statistics&lt;/h3&gt;
&lt;p&gt;You can go to &lt;code class=&quot;highlighter-rouge&quot;&gt;http://pi.hole/admin&lt;/code&gt; once you are connected to the VPN and see some of Pi-hole’s stats. The result is mind-boggling. Almost half of my traffic is to serve ads.&lt;/p&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/pi-hole-stats.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/pi-hole-stats.png&quot; alt=&quot;Pi-hole stats&quot; /&gt;
&lt;/picture&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Pi-hole is a good solution to fight against ads on the internet. You should give it a try. That said not all ads are bad. Some creators are reliant on ads as their source of income. If you have someone you support, consider whitelisting the ads for the good cause.&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.pi-hole.net/guides/vpn/overview/&quot;&gt;https://docs.pi-hole.net/guides/vpn/overview/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.digitalocean.com/community/tutorials/how-to-block-advertisements-at-the-dns-level-using-pi-hole-and-openvpn-on-ubuntu-16-04&quot;&gt;https://www.digitalocean.com/community/tutorials/how-to-block-advertisements-at-the-dns-level-using-pi-hole-and-openvpn-on-ubuntu-16-04&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://wiki.openvz.org/VPN_via_the_TUN/TAP_device&quot;&gt;https://wiki.openvz.org/VPN_via_the_TUN/TAP_device&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Jason Thai</name></author><category term="tech" /><category term="en" /><summary type="html">Introduction I have been playing around with setting up my own OpenVPN server lately and also found out Pi-hole. OpenVPN provides a way to set up a VPN that I can self manage and Pi-hole is a network wide ad blocking system. The two combined services provide a good way to make your web browsing experience more secure and ad-free. I followed the guide on Pi-hole to set up a VPN server but I found out that some information is missing depending on the type of VPS you have such as whether your VPS is a NAT VPS or not. Below is the documented steps of all my findings. Installation OpenVPN Setup Run these scripts: wget https://git.io/vpn -O openvpn-install.sh chmod 755 openvpn-install.sh ./openvpn-install.sh Follow this setup: Welcome to this quick OpenVPN &quot;road warrior&quot; installer I need to ask you a few questions before starting the setup You can leave the default options and just press enter if you are ok with them First I need to know the IPv4 address of the network interface you want OpenVPN listening to. IP address: 10.8.0.1 // Jason's notes: if you are behind NAT, just put your ipv4 IP address Which protocol do you want for OpenVPN connections? 1) UDP (recommended) 2) TCP Protocol [1-2]: 1 What port do you want OpenVPN listening to? Port: 1194 Which DNS do you want to use with the VPN? 1) Current system resolvers 2) Google 3) OpenDNS 4) NTT 5) Hurricane Electric 6) Verisign DNS [1-6]: 1 Finally, tell me your name for the client certificate Please, use one word only, no special characters Client name: pihole Okay, that was all I needed. We are ready to set up your OpenVPN server now Press any key to continue... Start OpenVPN Modify OpenVPN server’s configuration in /etc/openvpn/server/server.conf: remove all the existing push &quot;dhcp-option DNS x.x.x.x and add push &quot;dhcp-option DNS 10.8.0.1&quot; Restart OpenVPN services: systemctl daemon-reload systemctl restart openvpn // Jason's notes: just restarting openvpn does not change the configuration for OpenVPN server. systemctl restart openvpn-server@server.service Notes: if you are behind a NAT, you will also need to do the following: ip r | grep default # Output from ip r | grep default default via x.x.x.x dev eth0 onlink Note the value after dev in this case it is eth0 Run this: iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o &amp;lt;value you got from above&amp;gt; -j MASQUERADE # Example: iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE Pi-hole Setup Run this script: curl -sSL https://install.pi-hole.net | bash Follow the instruction to set up pi-hole: Installing dependencies Some instruction Some information This informs we need a static IP address in order the the whole thing to work The following step is important, make sure to select tun0 as the interface Choose the DNS provider Pi-hole will use. This is interesting. Essentially we will set up pi-hole as a DNS OpenVPN server will use, and within Pi-hole it will use the DNS setting below to make outbound requests. Choose the protocols available to you This following step is important, make sure to choose no so we can assign our internal address which is 10.8.0.1. Enter 10.8.0.1/24. This is the static address VPN will use to talk to Pi-hole Enter the ipv4-gateway. I just leave this as is. There are a few more steps but I just choose the default settings. Test DNS settings Run this script host google.com 10.8.0.1 # Output from host google.com 10.8.0.1 google.com has address 172.217.0.46 google.com has IPv6 address 2607:f8b0:4005:80b::200e google.com mail is handled by 10 aspmx.l.google.com. google.com mail is handled by 20 alt1.aspmx.l.google.com. google.com mail is handled by 30 alt2.aspmx.l.google.com. google.com mail is handled by 40 alt3.aspmx.l.google.com. google.com mail is handled by 50 alt4.aspmx.l.google.com. Our OpenVPN + Pi-hole still see google.com’s public IPs properly This time run host pagead2.googlesyndication.com # Output from host pagead2.googlesyndication.com pagead2.googlesyndication.com has address 0.0.0.0 pagead2.googlesyndication.com has IPv6 address :: pagead2.googlesyndication.com is an alias for pagead46.l.doubleclick.net. Pi-hole blocked pagead2.googlesyndication.com as the domain is in its blacklist. Firewall Setup I followed Pi-hole’s setup Generate OpenVPN Client Config File Run ./openvpn-install.sh Test From Browser After connecting to your VPN using OpenVPN client. Go to this address http://pagead2.googlesyndication.com, if everything works correctly you will see this: Pi-hole Statistics You can go to http://pi.hole/admin once you are connected to the VPN and see some of Pi-hole’s stats. The result is mind-boggling. Almost half of my traffic is to serve ads. Conclusion Pi-hole is a good solution to fight against ads on the internet. You should give it a try. That said not all ads are bad. Some creators are reliant on ads as their source of income. If you have someone you support, consider whitelisting the ads for the good cause. References https://docs.pi-hole.net/guides/vpn/overview/ https://www.digitalocean.com/community/tutorials/how-to-block-advertisements-at-the-dns-level-using-pi-hole-and-openvpn-on-ubuntu-16-04 https://wiki.openvz.org/VPN_via_the_TUN/TAP_device</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/openvpn-pihole.png" /><media:content medium="image" url="https://jasonthai.me/assets/img/openvpn-pihole.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">How to host Commento on Apache Webserver</title><link href="https://jasonthai.me/blog/2019/08/12/how-to-host-commento-on-apache-webserver/" rel="alternate" type="text/html" title="How to host Commento on Apache Webserver" /><published>2019-08-12T00:00:00+00:00</published><updated>2019-08-12T00:00:00+00:00</updated><id>https://jasonthai.me/blog/2019/08/12/how-to-host-commento-on-apache-webserver</id><content type="html" xml:base="https://jasonthai.me/blog/2019/08/12/how-to-host-commento-on-apache-webserver/">&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/commento-logo.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/commento-logo.png&quot; alt=&quot;Commento Logo&quot; /&gt;
&lt;/picture&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;I recently switched from using Disqus comment system to Commento. The reason is that I am in favor of a non-tracking and lightweight system which Commento satisfies. This note will go over the steps to host Commento using Apache webserver.&lt;/p&gt;

&lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;
&lt;p&gt;A few things you will need:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;A server. If you have not got one, I recommended using &lt;a href=&quot;https://m.do.co/c/c544762f5c36&quot;&gt;Digital Ocean&lt;/a&gt;. A $5 droplet is sufficient.&lt;/li&gt;
  &lt;li&gt;A domain which has an A record pointing your domain to your server’s IP. For example, I have an A record that points my subdomain &lt;code class=&quot;highlighter-rouge&quot;&gt;commento&lt;/code&gt; to my server’s IP so Commento is available on &lt;a href=&quot;https://commento.jasonthai.me&quot;&gt;https://commento.jasonthai.me&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When you create a VPS, you will be asked which OS to install. I chose to use Ubuntu 18.04 as there are a lot of tutorials online for Ubuntu to help you get started.&lt;/p&gt;

&lt;h2 id=&quot;setting-up-commento&quot;&gt;Setting up Commento&lt;/h2&gt;
&lt;h3 id=&quot;install-apache2&quot;&gt;Install Apache2&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-ubuntu-18-04-quickstart&quot;&gt;Follow this tutorial on Digital Ocean to help you get started setting up Apache&lt;/a&gt;.
It contains all the necessary information to help you install Apache.&lt;/p&gt;

&lt;h3 id=&quot;install-postgresql&quot;&gt;Install PostgreSQL&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.digitalocean.com/community/tutorials/how-to-install-and-use-postgresql-on-ubuntu-18-04&quot;&gt;Follow this tutorial to install PostgreSQL on your VPS&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I chose to create a new user &lt;code class=&quot;highlighter-rouge&quot;&gt;commento&lt;/code&gt; and database &lt;code class=&quot;highlighter-rouge&quot;&gt;commento&lt;/code&gt; so that I can use it later.&lt;/p&gt;

&lt;p&gt;To allow the new user to access the database without any password, I made the following change to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/postgresql/10/main/pg_hba.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# TYPE  DATABASE        USER            ADDRESS                 METHOD

# &quot;local&quot; is for Unix domain socket connections only
local   all             all                                     trust &amp;lt;- by default it is ident which required password input
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I also made the following change to &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/postgresql/10/main/postgresql.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// uncommented
listen_addresses = 'localhost'        # what IP address(es) to listen on;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is to allow using &lt;code class=&quot;highlighter-rouge&quot;&gt;localhost&lt;/code&gt; as the default host for connecting to postgres database on the server.&lt;/p&gt;

&lt;h3 id=&quot;installing-commento&quot;&gt;Installing Commento&lt;/h3&gt;
&lt;p&gt;In the following section, I use &lt;strong&gt;commento.jasonthai.me&lt;/strong&gt; as my subdomain to host Commento, you can just replace it with whatever domain you will be using&lt;/p&gt;

&lt;p&gt;Enter the following commands:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wget https://commento-release.s3.amazonaws.com/commento-linux-amd64-v1.7.0.tar.gz&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mkdir /usr/share/commento&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;tar xvf commento-linux-amd64-v1.7.0.tar.gz -C /usr/share/commento&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Create a new file &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/systemd/system/commento.service&lt;/code&gt;:&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-conf highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[&lt;span class=&quot;n&quot;&gt;Unit&lt;/span&gt;]
&lt;span class=&quot;n&quot;&gt;Description&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;Commento&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;daemon&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;service&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;After&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;network&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;postgresql&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;service&lt;/span&gt;

[&lt;span class=&quot;n&quot;&gt;Service&lt;/span&gt;]
&lt;span class=&quot;n&quot;&gt;Type&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;simple&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ExecStart&lt;/span&gt;=/&lt;span class=&quot;n&quot;&gt;usr&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;bin&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;commento&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_ORIGIN&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;https&lt;/span&gt;://&lt;span class=&quot;n&quot;&gt;commento&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;jasonthai&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;me&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_PORT&lt;/span&gt;=&lt;span class=&quot;m&quot;&gt;8080&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_POSTGRES&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;postgres&lt;/span&gt;://&lt;span class=&quot;n&quot;&gt;commento&lt;/span&gt;@&lt;span class=&quot;n&quot;&gt;localhost&lt;/span&gt;:&lt;span class=&quot;m&quot;&gt;5432&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;commento&lt;/span&gt;?&lt;span class=&quot;n&quot;&gt;sslmode&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;disable&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_STATIC&lt;/span&gt;=/&lt;span class=&quot;n&quot;&gt;usr&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;share&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;commento&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_FORBID_NEW_OWNERS&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;true&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_SMTP_HOST&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;ENTER&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YOUR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;VALUE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HERE&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_SMTP_PORT&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;ENTER&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YOUR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;VALUE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HERE&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_SMTP_USERNAME&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;ENTER&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YOUR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;VALUE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HERE&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_SMTP_PASSWORD&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;ENTER&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;YOUR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;VALUE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HERE&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_SMTP_FROM_ADDRESS&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;no&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;reply&lt;/span&gt;@&lt;span class=&quot;n&quot;&gt;commento&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;io&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Set Google OAuth credentials
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_GOOGLE_KEY&lt;/span&gt;=
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_GOOGLE_SECRET&lt;/span&gt;=

&lt;span class=&quot;c&quot;&gt;# Set Github OAuth credentials
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_GITHUB_KEY&lt;/span&gt;=
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_GITHUB_SECRET&lt;/span&gt;=

&lt;span class=&quot;c&quot;&gt;# Set Twitter OAuth credentials
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_TWITTER_KEY&lt;/span&gt;=
&lt;span class=&quot;n&quot;&gt;Environment&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;COMMENTO_TWITTER_SECRET&lt;/span&gt;=
[&lt;span class=&quot;n&quot;&gt;Install&lt;/span&gt;]
&lt;span class=&quot;n&quot;&gt;WantedBy&lt;/span&gt;=&lt;span class=&quot;n&quot;&gt;multi&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;user&lt;/span&gt;.&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;apache-config&quot;&gt;Apache Config&lt;/h3&gt;
&lt;p&gt;In the following section, I use &lt;strong&gt;commento.jasonthai.me&lt;/strong&gt; as my subdomain to host Commento, you can just replace the it with whatever domain you will be using.&lt;/p&gt;

&lt;p&gt;Create a new file &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/apache2/sites-available/commento.jasonthai.me.conf:&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;VirtualHost&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; *:80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;ServerAdmin&lt;/span&gt; webmaster@localhost
    &lt;span class=&quot;nc&quot;&gt;ServerName&lt;/span&gt; commento.jasonthai.me
    &lt;span class=&quot;nc&quot;&gt;ServerAlias&lt;/span&gt; commento.jasonthai.me
    &lt;span class=&quot;nc&quot;&gt;DocumentRoot&lt;/span&gt; /usr/share/commento

    &lt;span class=&quot;nc&quot;&gt;ProxyPreserveHost&lt;/span&gt; On
    &lt;span class=&quot;nc&quot;&gt;ProxyPass&lt;/span&gt; / http://127.0.0.1:8080/
    &lt;span class=&quot;nc&quot;&gt;ProxyPassReverse&lt;/span&gt; / http://127.0.0.1:8080/
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;VirtualHost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note: the above conf assumes you are not using any TLS/SSL certificates and we are exposing Commento through port 80 which is the default port you can access from your browser. If you choose to enable HTTPS for commento,  &lt;a href=&quot;https://www.digitalocean.com/community/tutorials/how-to-secure-apache-with-let-s-encrypt-on-ubuntu-18-04&quot;&gt;follow this tutorial to enable HTTPS on your server&lt;/a&gt;. This will greatly enhance the security of your Commento service.&lt;/p&gt;

&lt;p&gt;After running &lt;code class=&quot;highlighter-rouge&quot;&gt;Letsencrypt certbot&lt;/code&gt;, the apache config will look something like this instead:&lt;/p&gt;
&lt;div class=&quot;language-apache highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;VirtualHost&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; *:80&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;RewriteEngine&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;on&lt;/span&gt;
&lt;span class=&quot;nc&quot;&gt;RewriteCond&lt;/span&gt; %{SERVER_NAME} =commento.jasonthai.me
&lt;span class=&quot;nc&quot;&gt;RewriteRule&lt;/span&gt; ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;VirtualHost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;VirtualHost&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt; *:443&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;    &lt;span class=&quot;nc&quot;&gt;ServerAdmin&lt;/span&gt; webmaster@localhost
    &lt;span class=&quot;nc&quot;&gt;ServerName&lt;/span&gt; commento.jasonthai.me
    &lt;span class=&quot;nc&quot;&gt;ServerAlias&lt;/span&gt; commento.jasonthai.me
    &lt;span class=&quot;nc&quot;&gt;DocumentRoot&lt;/span&gt; /usr/share/commento

    &lt;span class=&quot;nc&quot;&gt;ProxyPreserveHost&lt;/span&gt; On
    &lt;span class=&quot;nc&quot;&gt;ProxyPass&lt;/span&gt; / http://127.0.0.1:8080/
    &lt;span class=&quot;nc&quot;&gt;ProxyPassReverse&lt;/span&gt; / http://127.0.0.1:8080/

    &lt;span class=&quot;nc&quot;&gt;ErrorLog&lt;/span&gt; ${APACHE_LOG_DIR}/error.log
    &lt;span class=&quot;nc&quot;&gt;CustomLog&lt;/span&gt; ${APACHE_LOG_DIR}/access.log combined
&lt;span class=&quot;nc&quot;&gt;SSLCertificateFile&lt;/span&gt; /etc/letsencrypt/live/commento.jasonthai.me/fullchain.pem
&lt;span class=&quot;nc&quot;&gt;SSLCertificateKeyFile&lt;/span&gt; /etc/letsencrypt/live/commento.jasonthai.me/privkey.pem
&lt;span class=&quot;nc&quot;&gt;Include&lt;/span&gt; /etc/letsencrypt/options-ssl-apache.conf
&lt;span class=&quot;p&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;VirtualHost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;running-commento&quot;&gt;Running Commento&lt;/h3&gt;
&lt;p&gt;Run &lt;code class=&quot;highlighter-rouge&quot;&gt;systemctl start commento&lt;/code&gt; to start Commento service.&lt;/p&gt;

&lt;p&gt;Run &lt;code class=&quot;highlighter-rouge&quot;&gt;systemctl enable commento&lt;/code&gt; to enable Commento as a background service.&lt;/p&gt;

&lt;p&gt;Run &lt;code class=&quot;highlighter-rouge&quot;&gt;systemctl status commento&lt;/code&gt; to check the status of Commento.&lt;/p&gt;

&lt;p&gt;After setting everything up, you can go to the domain that you set up to access Commento. If it works, you’ll be greeted with something like this:&lt;/p&gt;

&lt;picture&gt;
    &lt;source srcset=&quot;https://jasonthai.me/assets/img/commento.webp&quot; type=&quot;image/webp&quot; /&gt;
    &lt;img class=&quot;db ml-auto mr-auto&quot; src=&quot;https://jasonthai.me/assets/img/commento.png&quot; alt=&quot;Commento&quot; /&gt;
&lt;/picture&gt;

&lt;h2 id=&quot;adding-commento-to-your-site&quot;&gt;Adding Commento to Your Site&lt;/h2&gt;
&lt;p&gt;Put this to where you want the comments to show up:&lt;/p&gt;
&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;div&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;commento&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&amp;lt;/div&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;script &lt;/span&gt;&lt;span class=&quot;na&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;https://YOUR-DOMAIN-HERE/js/commento.js&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You should be seeing something similar to my site if everything works correctly.&lt;/p&gt;

&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.commento.io/&quot;&gt;https://docs.commento.io&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://oct8l.gitlab.io/posts/2018/129/setting-up-commento-with-hugo/&quot;&gt;https://oct8l.gitlab.io/posts/2018/129/setting-up-commento-with-hugo/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/fidiego/commento-heroku&quot;&gt;https://github.com/fidiego/commento-heroku&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Jason Thai</name></author><category term="tech" /><category term="en" /><summary type="html">Introduction I recently switched from using Disqus comment system to Commento. The reason is that I am in favor of a non-tracking and lightweight system which Commento satisfies. This note will go over the steps to host Commento using Apache webserver. Prerequisites A few things you will need: A server. If you have not got one, I recommended using Digital Ocean. A $5 droplet is sufficient. A domain which has an A record pointing your domain to your server’s IP. For example, I have an A record that points my subdomain commento to my server’s IP so Commento is available on https://commento.jasonthai.me When you create a VPS, you will be asked which OS to install. I chose to use Ubuntu 18.04 as there are a lot of tutorials online for Ubuntu to help you get started. Setting up Commento Install Apache2 Follow this tutorial on Digital Ocean to help you get started setting up Apache. It contains all the necessary information to help you install Apache. Install PostgreSQL Follow this tutorial to install PostgreSQL on your VPS I chose to create a new user commento and database commento so that I can use it later. To allow the new user to access the database without any password, I made the following change to /etc/postgresql/10/main/pg_hba.conf: # TYPE DATABASE USER ADDRESS METHOD # &quot;local&quot; is for Unix domain socket connections only local all all trust &amp;lt;- by default it is ident which required password input I also made the following change to /etc/postgresql/10/main/postgresql.conf: // uncommented listen_addresses = 'localhost' # what IP address(es) to listen on; This is to allow using localhost as the default host for connecting to postgres database on the server. Installing Commento In the following section, I use commento.jasonthai.me as my subdomain to host Commento, you can just replace it with whatever domain you will be using Enter the following commands: wget https://commento-release.s3.amazonaws.com/commento-linux-amd64-v1.7.0.tar.gz mkdir /usr/share/commento tar xvf commento-linux-amd64-v1.7.0.tar.gz -C /usr/share/commento Create a new file /etc/systemd/system/commento.service: [Unit] Description=Commento daemon service After=network.target postgresql.service [Service] Type=simple ExecStart=/usr/bin/commento Environment=COMMENTO_ORIGIN=https://commento.jasonthai.me Environment=COMMENTO_PORT=8080 Environment=COMMENTO_POSTGRES=postgres://commento@localhost:5432/commento?sslmode=disable Environment=COMMENTO_STATIC=/usr/share/commento Environment=COMMENTO_FORBID_NEW_OWNERS=true Environment=COMMENTO_SMTP_HOST=ENTER YOUR VALUE HERE Environment=COMMENTO_SMTP_PORT=ENTER YOUR VALUE HERE Environment=COMMENTO_SMTP_USERNAME=ENTER YOUR VALUE HERE Environment=COMMENTO_SMTP_PASSWORD=ENTER YOUR VALUE HERE Environment=COMMENTO_SMTP_FROM_ADDRESS=no-reply@commento.io # Set Google OAuth credentials Environment=COMMENTO_GOOGLE_KEY= Environment=COMMENTO_GOOGLE_SECRET= # Set Github OAuth credentials Environment=COMMENTO_GITHUB_KEY= Environment=COMMENTO_GITHUB_SECRET= # Set Twitter OAuth credentials Environment=COMMENTO_TWITTER_KEY= Environment=COMMENTO_TWITTER_SECRET= [Install] WantedBy=multi-user.target Apache Config In the following section, I use commento.jasonthai.me as my subdomain to host Commento, you can just replace the it with whatever domain you will be using. Create a new file /etc/apache2/sites-available/commento.jasonthai.me.conf: &amp;lt;VirtualHost *:80&amp;gt; ServerAdmin webmaster@localhost ServerName commento.jasonthai.me ServerAlias commento.jasonthai.me DocumentRoot /usr/share/commento ProxyPreserveHost On ProxyPass / http://127.0.0.1:8080/ ProxyPassReverse / http://127.0.0.1:8080/ &amp;lt;/VirtualHost&amp;gt; Note: the above conf assumes you are not using any TLS/SSL certificates and we are exposing Commento through port 80 which is the default port you can access from your browser. If you choose to enable HTTPS for commento, follow this tutorial to enable HTTPS on your server. This will greatly enhance the security of your Commento service. After running Letsencrypt certbot, the apache config will look something like this instead: &amp;lt;VirtualHost *:80&amp;gt; RewriteEngine on RewriteCond %{SERVER_NAME} =commento.jasonthai.me RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent] &amp;lt;/VirtualHost&amp;gt; &amp;lt;VirtualHost *:443&amp;gt; ServerAdmin webmaster@localhost ServerName commento.jasonthai.me ServerAlias commento.jasonthai.me DocumentRoot /usr/share/commento ProxyPreserveHost On ProxyPass / http://127.0.0.1:8080/ ProxyPassReverse / http://127.0.0.1:8080/ ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined SSLCertificateFile /etc/letsencrypt/live/commento.jasonthai.me/fullchain.pem SSLCertificateKeyFile /etc/letsencrypt/live/commento.jasonthai.me/privkey.pem Include /etc/letsencrypt/options-ssl-apache.conf &amp;lt;/VirtualHost&amp;gt; Running Commento Run systemctl start commento to start Commento service. Run systemctl enable commento to enable Commento as a background service. Run systemctl status commento to check the status of Commento. After setting everything up, you can go to the domain that you set up to access Commento. If it works, you’ll be greeted with something like this: Adding Commento to Your Site Put this to where you want the comments to show up: &amp;lt;div id=&quot;commento&quot;&amp;gt;&amp;lt;/div&amp;gt; &amp;lt;script defer src=&quot;https://YOUR-DOMAIN-HERE/js/commento.js&quot;&amp;gt; &amp;lt;/script&amp;gt; You should be seeing something similar to my site if everything works correctly. Resources https://docs.commento.io https://oct8l.gitlab.io/posts/2018/129/setting-up-commento-with-hugo/ https://github.com/fidiego/commento-heroku</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://jasonthai.me/assets/img/commento-logo.png" /><media:content medium="image" url="https://jasonthai.me/assets/img/commento-logo.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>